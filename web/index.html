<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ—Ö–æZ–∞V—Ä–∏–∫: –Æ—Ä—Å–∫–∞—è –≠—Ä–∞</title>
    <link rel="icon" href="/images/favicon_jurassic.ico" type="image/x-icon">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="jurassic-theme">
    <header class="site-header jurassic-header">
        <div class="header-container">
            <div class="game-logo">
                <img src="/images/logo_jurassic.png" alt="–õ–æ–≥–æ –Æ—Ä—Å–∫–æ–π –≠—Ä—ã" class="logo-image" id="logo-image">
                <h1 class="game-title jurassic-title">–õ–æ—Ö–æZ–∞V—Ä–∏–∫</h1>
            </div>
            
            <div id="auth-container" class="auth-container">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            </div>
        </div>
    </header>
    
    <div class="main-container jurassic-main">
    
    <div id="settings" class="settings-panel">
        <div class="toggle-container">
            <label class="toggle">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
            <span class="toggle-label">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
        </div>
        
        <div class="toggle-container">
            <label class="toggle">
                <input type="checkbox" id="sound-toggle" checked>
                <span class="slider"></span>
            </label>
            <span class="toggle-label">–ó–≤—É–∫ –≤–∫–ª/–≤—ã–∫–ª</span>
        </div>
    </div>
    
    <div id="game-container" class="jurassic-game-area">
        <div id="background-layer-1" class="parallax-bg"></div>
        <div id="background-layer-2" class="parallax-bg"></div>
        <div id="background-layer-3" class="parallax-bg"></div>
        
        <img id="player" src="/api/placeholder/48/52" alt="–ò–≥—Ä–æ–∫">
        
        <div id="ground" class="jurassic-ground"></div>
        
        <div id="score-container" class="game-hud">
            <div class="hud-item">–°—á—ë—Ç: <span id="score">0</span></div>
            <div class="hud-item">–ú–æ–Ω–µ—Ç: <span id="coins">0</span></div>
            <div id="music-controls" class="hud-item">
                <button id="music-toggle" class="hud-button">üîä</button>
            </div>
        </div>
    </div>
    
    <div id="game-buttons" class="action-buttons">
        <button id="start-button" class="action-button start">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="shop-button" class="action-button shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button id="profile-button" class="action-button profile" style="display: none;">–ü—Ä–æ—Ñ–∏–ª—å</button>
    </div>
    
    <button id="mobile-jump" class="mobile-jump-button jurassic-jump">–ü—Ä—ã–∂–æ–∫</button>
    
    <div id="stats-container" class="leaderboard-section">
        <h2 class="section-title">–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</h2>
        <div class="table-wrapper">
            <table id="leaderboard" class="jurassic-table">
                <thead>
                    <tr>
                        <th>–ú–µ—Å—Ç–æ</th>
                        <th>–ò–º—è</th>
                        <th>–°—á—ë—Ç</th>
                        <th>–ò–≥—Ä</th>
                        <th>–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <tr>
                        <td colspan="5" class="loading-cell">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="loading-spinner" class="jurassic-spinner">
        <div class="spinner-inner"></div>
    </div>

    <div id="modal-overlay" class="modal-overlay"></div>
    
    <div id="login-modal" class="jurassic-modal auth-modal">
        <button class="close-button" id="login-close">&times;</button>
        <h2 class="modal-title">–í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h2>
        <div id="login-message" class="message" style="display: none;"></div>
        
        <div class="form-row">
            <label for="login-username">–ò–º—è:</label>
            <input type="text" id="login-username" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º">
        </div>
        
        <div class="form-row">
            <label for="login-password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="login-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
        </div>
        
        <button id="login-submit" class="action-button submit">–í–æ–π—Ç–∏</button>
        
        <div class="auth-links">
            <span class="auth-link" id="to-register">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
        </div>
    </div>
    
    <div id="register-modal" class="jurassic-modal auth-modal">
        <button class="close-button" id="register-close">&times;</button>
        <h2 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <div id="register-message" class="message" style="display: none;"></div>
        
        <div class="form-row">
            <label for="register-username">–ò–º—è:</label>
            <input type="text" id="register-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
        </div>
        
        <div class="form-row">
            <label for="register-password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="register-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        
        <div class="form-row">
            <label for="register-confirm">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ:</label>
            <input type="password" id="register-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        
        <button id="register-submit" class="action-button submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        
        <div class="auth-links">
            <span class="auth-link" id="to-login">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</span>
        </div>
    </div>
    
    <div id="profile-modal" class="jurassic-modal profile-display">
        <button class="close-button" id="profile-close">&times;</button>
        <h2 class="modal-title profile-title">–ü—Ä–æ—Ñ–∏–ª—å: <span id="profile-username">Username</span></h2>
        
        <div class="profile-stats-grid">
            <div class="stat-item">
                <span class="stat-icon coins"></span>
                <div class="stat-value" id="profile-coins">0</div>
                <div class="stat-label">–ú–æ–Ω–µ—Ç</div>
            </div>
            <div class="stat-item">
                <span class="stat-icon highscore"></span>
                <div class="stat-value" id="profile-highscore">0</div>
                <div class="stat-label">–†–µ–∫–æ—Ä–¥</div>
            </div>
            <div class="stat-item">
                <span class="stat-icon games"></span>
                <div class="stat-value" id="profile-games">0</div>
                <div class="stat-label">–ò–≥—Ä</div>
            </div>
            <div class="stat-item">
                <span class="stat-icon time"></span>
                <div class="stat-value" id="profile-time">0</div>
                <div class="stat-label">–í—Ä–µ–º—è (–º–∏–Ω)</div>
            </div>
        </div>
        
        <div class="profile-actions">
            <button id="logout-button" class="action-button logout">–í—ã–π—Ç–∏</button>
        </div>
    </div>
    
    <div id="game-over" class="jurassic-modal game-over-modal">
        <button class="close-button" id="game-over-close">&times;</button>
        <h2 class="modal-title">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
        <div class="game-over-stats">
            <p>–°—á—ë—Ç: <span id="final-score">0</span></p>
            <p>–ú–æ–Ω–µ—Ç: <span id="final-coins">0</span></p>
        </div>
        <div class="game-over-buttons action-buttons">
            <button id="restart-btn" class="action-button restart">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            <button id="shop-btn-modal" class="action-button shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        </div>
    </div>
    
    <div id="shop-modal" class="jurassic-modal shop-display">
        <button class="close-button" id="shop-close">&times;</button>
        <h2 class="modal-title">–ú–∞–≥–∞–∑–∏–Ω</h2>
        
        <div class="shop-header">
            <div class="shop-balance">
                <span class="coin-icon"></span>
                <span id="shop-coins">0</span> –º–æ–Ω–µ—Ç
            </div>
            <div id="char-owned" class="character-count">
                –ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π: <span id="owned-count">1</span> / <span id="total-count">?</span>
            </div>
        </div>
        
        <div class="shop-items scrollable-list" id="character-list">
            <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>

    <audio id="background-music" loop></audio>
    <audio id="jump-sound"></audio>
    <audio id="coin-sound"></audio>
    <audio id="game-over-sound"></audio>
    <audio id="purchase-sound"></audio>
    <audio id="game-start-sound"></audio>

    <script>
        // ============= –ù–ê–°–¢–†–û–ô–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ò –ó–í–£–ö–û–í =============
        const JURASSIC_ASSETS = {
            backgroundLayer1: '/images/jurassic/bg_layer_1.png',
            backgroundLayer2: '/images/jurassic/bg_layer_2.png',
            backgroundLayer3: '/images/jurassic/bg_layer_3.png',
            ground: '/images/jurassic/ground.png',
            playerDefault: '/images/players/default/player_jurassic.png',
            obstaclePterodactyl: '/images/obstacles/jurassic/pterodactyl.png',
            obstacleTRex: '/images/obstacles/jurassic/trex.png',
            obstacleRaptor: '/images/obstacles/jurassic/raptor.png',
            obstaclePlant: '/images/obstacles/jurassic/plant.png',
            obstacleRock: '/images/obstacles/jurassic/rock_jurassic.png',
            coinAmber: '/images/coins/jurassic/coin_amber.png',
            coinFossil: '/images/coins/jurassic/coin_fossil.png',
            coinEgg: '/images/coins/jurassic/coin_egg.png',
            bonusShieldAmber: '/images/bonuses/jurassic/bonus_shield_amber.png',
            bonusSlowTar: '/images/bonuses/jurassic/bonus_slow_tar.png',
            bonusMagnetVine: '/images/bonuses/jurassic/bonus_magnet_vine.png',
            logo: '/images/logo_jurassic.png',
            headerBg: '/images/jurassic/header_bg_jurassic.png',
            iconCoins: '/images/icons/coins_jurassic.png',
            iconHighscore: '/images/icons/highscore_jurassic.png',
            iconGames: '/images/icons/games_jurassic.png',
            iconTime: '/images/icons/time_jurassic.png',
        };

        const CHARACTERS = [
            {
                id: 'default',
                name: '–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫ –†–µ–∫—Å',
                image: JURASSIC_ASSETS.playerDefault,
                width: 80,
                height: 95,
                hitboxWidth: 60,
                hitboxHeight: 75,
                jumpHeight: 210,
                price: 0,
                unlocked: true,
                sounds: {
                    jump: '/sounds/players/default/jump.mp3',
                    coin: '/sounds/players/default/coin.mp3',
                    gameOver: ['/sounds/players/default/game_over_0.mp3', '/sounds/players/default/game_over_1.mp3'],
                    gameStart: ['/sounds/players/default/game_start_0.mp3']
                },
                color: '#795548'
            },
            {
                id: 'character1',
                name: '–ü—Ç–µ—Ä–æ–¥–∞–∫—Ç–∏–ª—å',
                image: '/images/players/jurassic/player_pterodactyl.png',
                width: 100,
                height: 80,
                hitboxWidth: 75,
                hitboxHeight: 50,
                jumpHeight: 230,
                price: 50,
                sounds: {
                    jump: '/sounds/jurassic/jump_pterodactyl.mp3',
                    coin: '/sounds/jurassic/coin_collect_amber.mp3',
                    gameOver: ['/sounds/jurassic/game_over_roar_0.mp3', '/sounds/jurassic/game_over_roar_1.mp3'],
                    gameStart: ['/sounds/jurassic/game_start_stomp_0.mp3']
                },
                color: '#FF9800'
            },
            {
                id: 'character2',
                name: '–†–∞–ø—Ç–æ—Ä',
                image: '/images/players/jurassic/player_raptor.png',
                width: 90,
                height: 70,
                hitboxWidth: 70,
                hitboxHeight: 55,
                jumpHeight: 190,
                price: 100,
                sounds: {
                    jump: '/sounds/jurassic/jump_raptor.mp3',
                    coin: '/sounds/jurassic/coin_collect_fossil.mp3',
                    gameOver: ['/sounds/jurassic/game_over_roar_0.mp3', '/sounds/jurassic/game_over_roar_1.mp3'],
                    gameStart: ['/sounds/jurassic/game_start_stomp_0.mp3']
                },
                color: '#4CAF50'
            },
            {
                id: 'character3',
                name: '–õ–µ–æ–Ω–∏–¥',
                image: '/images/players/leonid/player_leonid.png',
                width: 98,
                height: 115,
                hitboxWidth: 72,
                hitboxHeight: 91,
                jumpHeight: 210,
                price: 100,
                sounds: {
                    jump: '/sounds/leonid/jump.mp3',
                    coin: '/sounds/leonid/coin.mp3',
                    gameOver: ['/sounds/leonid/game_over_0.mp3', '/sounds/leonid/game_over_1.mp3', '/sounds/leonid/game_over_2.mp3'],
                    gameStart: ['/sounds/leonid/game_start_0.mp3', '/sounds/leonid/game_start_1.mp3', '/sounds/leonid/game_start_2.mp3']
                },
                color: '#4caf50'
            },
            {
                id: 'character4',
                name: '–ü–∏–¥–∏–¥–∏',
                image: '/images/players/pididi/player_pididi.png',
                width: 84,
                height: 101,
                hitboxWidth: 62,
                hitboxHeight: 82,
                jumpHeight: 192,
                price: 100,
                sounds: {
                    jump: '/sounds/pididi/jump.mp3',
                    coin: '/sounds/pididi/coin.mp3',
                    gameOver: ['/sounds/pididi/game_over_0.mp3', '/sounds/pididi/game_over_1.mp3', '/sounds/pididi/game_over_2.mp3'],
                    gameStart: ['/sounds/pididi/game_start_0.mp3', '/sounds/pididi/game_start_1.mp3', '/sounds/pididi/game_start_2.mp3']
                },
                color: '#9c27b0'
            },
            {
                id: 'character5',
                name: '–°–∫–∏–±–∏–¥–∏',
                image: '/images/players/skibidi/player_skibidi.png',
                width: 94,
                height: 108,
                hitboxWidth: 66,
                hitboxHeight: 86,
                jumpHeight: 216,
                price: 30,
                sounds: {
                    jump: '/sounds/skibidi/jump.mp3',
                    coin: '/sounds/skibidi/coin.mp3',
                    gameOver: ['/sounds/skibidi/game_over_0.mp3', '/sounds/skibidi/game_over_1.mp3', '/sounds/skibidi/game_over_2.mp3'],
                    gameStart: ['/sounds/skibidi/game_start_0.mp3', '/sounds/skibidi/game_start_1.mp3', '/sounds/skibidi/game_start_2.mp3']
                },
                color: '#e91e63'
            }
        ];

        const OBSTACLES = [
            {
                id: 'pterodactyl',
                image: JURASSIC_ASSETS.obstaclePterodactyl,
                width: 70, height: 55, hitboxWidth: 50, hitboxHeight: 30,
                speed: 1.2, isFlying: true, minHeight: 80, maxHeight: 180
            },
            {
                id: 'plant',
                image: JURASSIC_ASSETS.obstaclePlant,
                width: 60, height: 70, hitboxWidth: 40, hitboxHeight: 50, speed: 0.9
            },
            {
                id: 'rock_jurassic',
                image: JURASSIC_ASSETS.obstacleRock,
                width: 65, height: 55, hitboxWidth: 45, hitboxHeight: 35, speed: 1.0
            },
            {
                id: 'raptor',
                image: JURASSIC_ASSETS.obstacleRaptor,
                width: 80, height: 60, hitboxWidth: 60, hitboxHeight: 45, speed: 1.1
            },
            {
                id: 'trex_head',
                image: JURASSIC_ASSETS.obstacleTRex,
                width: 90, height: 100, hitboxWidth: 70, hitboxHeight: 70,
                speed: 0.8, isFlying: true,
                minHeight: 150, maxHeight: 220
            }
        ];

        const COINS = [
            { id: 'amber', image: JURASSIC_ASSETS.coinAmber, width: 32, height: 32, hitboxWidth: 26, hitboxHeight: 26, value: 1 },
            { id: 'fossil', image: JURASSIC_ASSETS.coinFossil, width: 36, height: 36, hitboxWidth: 30, hitboxHeight: 30, value: 3, rarity: 0.3 },
            { id: 'egg', image: JURASSIC_ASSETS.coinEgg, width: 40, height: 40, hitboxWidth: 34, hitboxHeight: 34, value: 5, rarity: 0.1 }
        ];

        const BONUSES = [
            { id: 'shield_amber', image: JURASSIC_ASSETS.bonusShieldAmber, width: 45, height: 45, hitboxWidth: 40, hitboxHeight: 40, effect: 'shield', duration: 10000, rarity: 0.05 },
            { id: 'slow_tar', image: JURASSIC_ASSETS.bonusSlowTar, width: 45, height: 45, hitboxWidth: 40, hitboxHeight: 40, effect: 'slow', duration: 5000, rarity: 0.08 },
            { id: 'magnet_vine', image: JURASSIC_ASSETS.bonusMagnetVine, width: 45, height: 45, hitboxWidth: 40, hitboxHeight: 40, effect: 'magnet', duration: 8000, rarity: 0.07 }
        ];

        const SOUNDS = {
            background: '/sounds/jurassic/background_ambient.mp3',
            jump: '/sounds/defaults/jump.mp3',
            coin: '/sounds/jurassic/coin_collect.mp3',
            gameOver: ['/sounds/jurassic/game_over_roar.mp3'],
            gameStart: ['/sounds/jurassic/game_start_stomp.mp3'],
            purchase: '/sounds/defaults/purchase.mp3',
            bonus: '/sounds/jurassic/bonus_collect.mp3',
            shieldEnd: '/sounds/jurassic/shield_break.mp3',
            levelUp: '/sounds/jurassic/level_up_roar.mp3'
        };

        const SOUND_VOLUME = {
            background: 0.09,
            effects: 0.4,
        };

        const API_URL = 'http://192.168.0.240/api';

        class GameAPI {
            constructor() {
                this.currentUser = null;
                this.sessionStartTime = null;
                this.timeInterval = null;
                this.apiToken = localStorage.getItem('lohozavrikToken') || null;
                this.apiUrl = '/api';
                
                if (this.apiToken) {
                    this.verifyToken();
                }
            }
            
            async verifyToken() {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/verify-token`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        this.currentUser = data.user;
                        this.startTimeTracking();
                        return true;
                    } else {
                        this.logout();
                        return false;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:', error);
                    hideLoading();
                    return false;
                }
            }
            
            async register(username, password) {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.token && data.user) {
                        this.apiToken = data.token;
                        this.currentUser = data.user;
                        localStorage.setItem('lohozavrikToken', this.apiToken);
                        
                        this.startTimeTracking();
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            async login(username, password) {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.token && data.user) {
                        this.apiToken = data.token;
                        this.currentUser = data.user;
                        
                        localStorage.setItem('lohozavrikToken', this.apiToken);
                        
                        this.startTimeTracking();
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            logout() {
                if (this.currentUser) {
                    this.saveTimeSpent();
                    
                    this.currentUser = null;
                    this.apiToken = null;
                    localStorage.removeItem('lohozavrikToken');
                    clearInterval(this.timeInterval);
                    
                    return { success: true, message: "–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã" };
                }
                
                return { success: false, message: "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" };
            }
            
            startTimeTracking() {
                this.sessionStartTime = new Date();
                
                clearInterval(this.timeInterval);
                this.timeInterval = setInterval(() => {
                    this.saveTimeSpent();
                }, 60000);
            }
            
            async saveTimeSpent() {
                if (this.currentUser && this.sessionStartTime && this.apiToken) {
                    const now = new Date();
                    const minutesSpent = Math.floor((now - this.sessionStartTime) / 60000);
                    
                    if (minutesSpent > 0) {
                        try {
                            await fetch(`${this.apiUrl}/update-time`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${this.apiToken}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ minutesSpent })
                            });
                            
                            if (this.currentUser.totalTimeMinutes) {
                                this.currentUser.totalTimeMinutes += minutesSpent;
                            }
                            
                            this.sessionStartTime = now;
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', error);
                        }
                    }
                }
            }
            
            async updateUserStats(score, coinsCollected) {
                if (!this.currentUser || !this.apiToken) {
                    return { success: false, message: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω" };
                }
                
                try {
                    const duration = Math.floor((Date.now() - gameStartTime) / 1000);
                    
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/update-stats`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ score, coinsCollected, duration })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        this.currentUser = data.user;
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            async buyCharacter(characterId) {
                if (!this.currentUser || !this.apiToken) {
                    return { success: false, message: "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" };
                }
                
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/buy-character`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ characterId })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        this.currentUser = data.user;
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            async setActiveCharacter(characterId) {
                if (!this.currentUser || !this.apiToken) {
                    return { success: false, message: "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" };
                }
                
                if (!this.currentUser.characters.includes(characterId)) {
                    return { success: false, message: "–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" };
                }
                
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/set-active-character`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ characterId })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        this.currentUser = data.user;
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            async getGlobalLeaderboard() {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/leaderboard`);
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.leaderboard) {
                        return data.leaderboard;
                    }
                    
                    return [];
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤:', error);
                    hideLoading();
                    return [];
                }
            }
        }
        
        const gameAPI = new GameAPI();
        
        function showLoading() {
            document.getElementById('loading-spinner').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loading-spinner').style.display = 'none';
        }
        
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const scoreDisplay = document.getElementById('score');
        const coinsDisplay = document.getElementById('coins');
        const gameOverScreen = document.getElementById('game-over');
        const gameOverClose = document.getElementById('game-over-close');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalCoinsDisplay = document.getElementById('final-coins');
        const restartBtn = document.getElementById('restart-btn');
        const shopBtnModal = document.getElementById('shop-btn-modal');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const themeToggle = document.getElementById('theme-toggle');
        const soundToggle = document.getElementById('sound-toggle');
        const musicToggle = document.getElementById('music-toggle');
        const shopButton = document.getElementById('shop-button');
        const profileButton = document.getElementById('profile-button');
        const shopModal = document.getElementById('shop-modal');
        const shopClose = document.getElementById('shop-close');
        const modalOverlay = document.getElementById('modal-overlay');
        const characterList = document.getElementById('character-list');
        const shopCoinsDisplay = document.getElementById('shop-coins');
        const ownedCountDisplay = document.getElementById('owned-count');
        const totalCountDisplay = document.getElementById('total-count');
        const startButton = document.getElementById('start-button');
        const mobileJumpButton = document.getElementById('mobile-jump');
        
        const authContainer = document.getElementById('auth-container');
        const loginModal = document.getElementById('login-modal');
        const loginClose = document.getElementById('login-close');
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const loginSubmit = document.getElementById('login-submit');
        const loginMessage = document.getElementById('login-message');
        const registerModal = document.getElementById('register-modal');
        const registerClose = document.getElementById('register-close');
        const registerUsername = document.getElementById('register-username');
        const registerPassword = document.getElementById('register-password');
        const registerConfirm = document.getElementById('register-confirm');
        const registerSubmit = document.getElementById('register-submit');
        const registerMessage = document.getElementById('register-message');
        const toRegister = document.getElementById('to-register');
        const toLogin = document.getElementById('to-login');
        const profileModal = document.getElementById('profile-modal');
        const profileClose = document.getElementById('profile-close');
        const profileUsername = document.getElementById('profile-username');
        const profileCoins = document.getElementById('profile-coins');
        const profileHighscore = document.getElementById('profile-highscore');
        const profileGames = document.getElementById('profile-games');
        const profileTime = document.getElementById('profile-time');
        const logoutButton = document.getElementById('logout-button');
        
        const backgroundMusic = document.getElementById('background-music');
        const jumpSound = document.getElementById('jump-sound');
        const coinSound = document.getElementById('coin-sound');
        const gameOverSound = document.getElementById('game-over-sound');
        const purchaseSound = document.getElementById('purchase-sound');
        const gameStartSound = document.getElementById('game-start-sound');
        
        let bonusSound = document.createElement('audio');
        let shieldEndSound = document.createElement('audio');
        let levelUpSound = document.createElement('audio');
        
        backgroundMusic.src = SOUNDS.background;
        jumpSound.src = SOUNDS.jump;
        coinSound.src = SOUNDS.coin;
        gameOverSound.src = SOUNDS.gameOver[0] || SOUNDS.gameOver;
        purchaseSound.src = SOUNDS.purchase;
        gameStartSound.src = SOUNDS.gameStart[0] || SOUNDS.gameStart; // –ë–µ—Ä–µ–º –∏–ª–∏ –ø–µ—Ä–≤—ã–π –∏–∑ –º–∞—Å—Å–∏–≤–∞, –∏–ª–∏ —Å—Ç—Ä–æ–∫—É
        bonusSound.src = SOUNDS.bonus;
        shieldEndSound.src = SOUNDS.shieldEnd;
        levelUpSound.src = SOUNDS.levelUp;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤
        backgroundMusic.volume = SOUND_VOLUME.background;
        jumpSound.volume = SOUND_VOLUME.effects;
        coinSound.volume = SOUND_VOLUME.effects;
        gameOverSound.volume = SOUND_VOLUME.effects;
        purchaseSound.volume = SOUND_VOLUME.effects;
        gameStartSound.volume = SOUND_VOLUME.effects;
        bonusSound.volume = SOUND_VOLUME.effects;
        shieldEndSound.volume = SOUND_VOLUME.effects;
        levelUpSound.volume = SOUND_VOLUME.effects;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let activeCharacter = null;
        let gameSpeed = 16; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 14 –¥–æ 16 - –ø–æ–≤—ã—à–∞–µ–º –±–∞–∑–æ–≤—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã
        let backgroundPos = 0;
        let score = 0;
        let coinCount = 0;
        let currentLevel = 1;
        let gameStartTime = 0;
        let gameTime = 0;
        let isJumping = false;
        let isGameOver = false;
        let isGameStarted = false;
        let debugMode = false;
        let gameLoop;
        
        // –ú–∞—Å—Å–∏–≤—ã –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        let obstacles = [];
        let coins = [];
        let bonuses = [];
        
        // –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
        let obstacleInterval = 1400; // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1600 –¥–æ 1400 –º—Å
        let coinInterval = 1000; // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1100 –¥–æ 1000 –º—Å
        let bonusInterval = 8000; // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10000 –¥–æ 8000 –º—Å
        let nextObstacleTime = 0;
        let nextCoinTime = 0;
        let nextBonusTime = 0;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
        let hasShield = false;
        let hasMagnet = false;
        let hasSlowMotion = false;
        let shieldTimer, magnetTimer, slowTimer;
        
        // –ó–≤—É–∫
        let soundEnabled = true;
        let musicPlaying = false;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateAuthUI() {
            const authContainer = document.getElementById('auth-container');
            
            // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                authContainer.innerHTML = '';
                
            if (gameAPI.currentUser) {
                // –°–æ–∑–¥–∞–µ–º UI –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userProfile = document.createElement('div');
                userProfile.className = 'user-profile';
                
                // –ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∏–º–µ–Ω–∏)
                const avatar = document.createElement('div');
                avatar.className = 'profile-avatar';
                avatar.textContent = gameAPI.currentUser.username.charAt(0).toUpperCase();
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const details = document.createElement('div');
                details.className = 'profile-details';
                
                const name = document.createElement('div');
                name.className = 'profile-name';
                name.textContent = gameAPI.currentUser.username;
                
                const stats = document.createElement('div');
                stats.className = 'profile-stats';
                stats.textContent = `${gameAPI.currentUser.coins} –º–æ–Ω–µ—Ç ‚Ä¢ –†–µ–∫–æ—Ä–¥: ${gameAPI.currentUser.highScore}`;
                
                details.appendChild(name);
                details.appendChild(stats);
                
                // –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
                const menu = document.createElement('div');
                menu.className = 'profile-menu';
                
                // –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é
                const profileItem = document.createElement('div');
                profileItem.className = 'profile-menu-item';
                profileItem.textContent = '–ü—Ä–æ—Ñ–∏–ª—å';
                profileItem.addEventListener('click', function() {
                    showProfileModal();
                });
                
                const logoutItem = document.createElement('div');
                logoutItem.className = 'profile-menu-item logout';
                logoutItem.textContent = '–í—ã–π—Ç–∏';
                logoutItem.addEventListener('click', function() {
                    const result = gameAPI.logout();
                    if (result.success) {
                        updateAuthUI();
                        createShopItems();
                        initPlayerImage();
                    }
                });
                
                menu.appendChild(profileItem);
                menu.appendChild(logoutItem);
                
                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤–º–µ—Å—Ç–µ
                userProfile.appendChild(avatar);
                userProfile.appendChild(details);
                userProfile.appendChild(menu);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é
                userProfile.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const menu = this.querySelector('.profile-menu');
                    const rect = this.getBoundingClientRect();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
                    menu.style.top = (rect.bottom + 5) + 'px';
                    menu.style.right = (window.innerWidth - rect.right) + 'px';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                    const isDisplayed = menu.style.display === 'block';
                    menu.style.display = isDisplayed ? 'none' : 'block';
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                    setTimeout(() => {
                        menu.style.opacity = isDisplayed ? '0' : '1';
                        menu.style.transform = isDisplayed ? 'translateY(-10px)' : 'translateY(0)';
                    }, 10);
                });
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤ –¥—Ä—É–≥—É—é –æ–±–ª–∞—Å—Ç—å
                document.addEventListener('click', function(e) {
                    const menu = document.querySelector('.profile-menu');
                    if (menu && menu.style.display === 'block' && !e.target.closest('.user-profile')) {
                        menu.style.opacity = '0';
                        menu.style.transform = 'translateY(-10px)';
                        setTimeout(() => {
                            menu.style.display = 'none';
                        }, 300);
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
                userProfile.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    const menu = this.querySelector('.profile-menu');
                    const rect = this.getBoundingClientRect();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
                    menu.style.top = (rect.bottom + 5) + 'px';
                    menu.style.right = (window.innerWidth - rect.right) + 'px';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                    const isDisplayed = menu.style.display === 'block';
                    menu.style.display = isDisplayed ? 'none' : 'block';
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                    setTimeout(() => {
                        menu.style.opacity = isDisplayed ? '0' : '1';
                        menu.style.transform = isDisplayed ? 'translateY(-10px)' : 'translateY(0)';
                    }, 10);
                });
                
                authContainer.appendChild(userProfile);
                
                // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ñ–∏–ª—è
                profileButton.style.display = 'inline-block';
            } else {
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const loginButton = document.createElement('button');
                loginButton.id = 'login-button';
                loginButton.className = 'game-button';
                loginButton.textContent = '–í–æ–π—Ç–∏';
                loginButton.addEventListener('click', showLoginModal);
                
                const registerButton = document.createElement('button');
                registerButton.id = 'register-button';
                registerButton.className = 'game-button';
                registerButton.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
                registerButton.addEventListener('click', showRegisterModal);
                
                authContainer.appendChild(loginButton);
                authContainer.appendChild(registerButton);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ñ–∏–ª—è
                profileButton.style.display = 'none';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateProfileModal() {
            if (gameAPI.currentUser) {
                profileUsername.textContent = gameAPI.currentUser.username;
                profileCoins.textContent = gameAPI.currentUser.coins;
                profileHighscore.textContent = gameAPI.currentUser.highScore;
                profileGames.textContent = gameAPI.currentUser.gamesPlayed;
                profileTime.textContent = gameAPI.currentUser.totalTimeMinutes;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            if (themeToggle.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞
        function toggleSound() {
            soundEnabled = soundToggle.checked;
            localStorage.setItem('sound', soundEnabled ? 'on' : 'off');
            
            if (!soundEnabled) {
                backgroundMusic.pause();
                musicPlaying = false;
                musicToggle.textContent = 'üîá';
            } else if (isGameStarted && !isGameOver) {
                musicToggle.textContent = 'üîä';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏
        function toggleMusic() {
            if (soundEnabled) {
                if (musicPlaying) {
                    backgroundMusic.pause();
                    musicPlaying = false;
                    musicToggle.textContent = 'üîá';
                } else {
                    backgroundMusic.volume = SOUND_VOLUME.background;
                    backgroundMusic.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                    musicPlaying = true;
                    musicToggle.textContent = 'üîä';
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
        async function updateLeaderboard() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
            leaderboardBody.innerHTML = '<tr><td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>';
            
            // –ü–æ–ª—É—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const globalLeaderboard = await gameAPI.getGlobalLeaderboard();
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Ç–∞–±–ª–∏—Ü—É
            leaderboardBody.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
            if (globalLeaderboard.length > 0) {
                globalLeaderboard.forEach(entry => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${entry.rank}</td>
                        <td>${entry.username}</td>
                        <td>${entry.highScore}</td>
                        <td>${entry.gamesPlayed}</td>
                        <td>${entry.date}</td>
                    `;
                    
                    leaderboardBody.appendChild(row);
                });
            } else {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                leaderboardBody.innerHTML = '<tr><td colspan="5">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        async function setActiveCharacter(characterId) {
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
            const character = CHARACTERS.find(char => char.id === characterId);
            if (!character) return;
            
            if (gameAPI.currentUser) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                const result = await gameAPI.setActiveCharacter(characterId);
                
                if (result.success) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    activeCharacter = character;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    player.src = character.image;
                    player.style.width = character.width + 'px';
                    player.style.height = character.height + 'px';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    if (character.sounds) {
                        jumpSound.src = character.sounds.jump || SOUNDS.jump;
                        coinSound.src = character.sounds.coin || SOUNDS.coin;
                        gameOverSound.src = character.sounds.gameOver || SOUNDS.gameOver;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
                    createShopItems();
                }
            } else {
                // –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∑–≤—É–∫–∏
                activeCharacter = character;
                player.src = character.image;
                player.style.width = character.width + 'px';
                player.style.height = character.height + 'px';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (character.sounds) {
                    jumpSound.src = character.sounds.jump || SOUNDS.jump;
                    coinSound.src = character.sounds.coin || SOUNDS.coin;
                    gameOverSound.src = character.sounds.gameOver || SOUNDS.gameOver;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –≤ localStorage
                localStorage.setItem('guestActiveCharacter', characterId);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
        function createShopItems() {
            characterList.innerHTML = '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–∏—Å–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            let unlockedCharacters = ['default'];
            let activeCharacterId = 'default';
            
            if (gameAPI.currentUser) {
                unlockedCharacters = gameAPI.currentUser.characters;
                activeCharacterId = gameAPI.currentUser.activeCharacter;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
                shopCoinsDisplay.textContent = gameAPI.currentUser.coins;
                ownedCountDisplay.textContent = unlockedCharacters.length;
            } else {
                // –î–ª—è –≥–æ—Å—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                activeCharacterId = localStorage.getItem('guestActiveCharacter') || 'default';
                shopCoinsDisplay.textContent = '0 (–≥–æ—Å—Ç—å)';
                ownedCountDisplay.textContent = '1';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            CHARACTERS.forEach(character => {
                const isUnlocked = unlockedCharacters.includes(character.id);
                const isActive = activeCharacterId === character.id;
                
                const characterItem = document.createElement('div');
                characterItem.className = `shop-item ${isActive ? 'selected' : ''}`;
                characterItem.dataset.id = character.id;
                
                const characterImage = document.createElement('img');
                characterImage.src = character.image;
                characterImage.className = 'character-preview';
                characterImage.alt = character.name;
                
                const characterName = document.createElement('div');
                characterName.className = 'character-name';
                characterName.textContent = character.name;
                
                const characterPrice = document.createElement('div');
                characterPrice.className = 'character-price';
                
                if (character.price > 0) {
                    const coinIcon = document.createElement('div');
                    coinIcon.className = 'coin-icon';
                    
                    const priceText = document.createElement('span');
                    priceText.textContent = character.price;
                    
                    characterPrice.appendChild(coinIcon);
                    characterPrice.appendChild(priceText);
                } else {
                    characterPrice.textContent = '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ';
                }
                
                const characterActions = document.createElement('div');
                characterActions.className = 'character-actions';
                
                if (isUnlocked) {
                    // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞
                    const selectButton = document.createElement('button');
                    selectButton.className = 'select-button';
                    selectButton.textContent = isActive ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å';
                    selectButton.disabled = isActive;
                    
                    selectButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        setActiveCharacter(character.id);
                    });
                    
                    characterActions.appendChild(selectButton);
                } else if (gameAPI.currentUser) {
                    // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
                    const buyButton = document.createElement('button');
                    buyButton.className = 'buy-button';
                    buyButton.textContent = '–ö—É–ø–∏—Ç—å';
                    buyButton.disabled = gameAPI.currentUser.coins < character.price;
                    
                    buyButton.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        
                        // –ü–æ–∫—É–ø–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —á–µ—Ä–µ–∑ API
                        const result = await gameAPI.buyCharacter(character.id);
                        
                        if (result.success) {
                            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –ø–æ–∫—É–ø–∫–∏
                            if (soundEnabled && purchaseSound.src) {
                                purchaseSound.volume = SOUND_VOLUME.effects;
                                purchaseSound.currentTime = 0;
                                purchaseSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                            }
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                            createShopItems();
                            updateAuthUI();
                        } else {
                            alert(result.message);
                        }
                    });
                    
                    characterActions.appendChild(buyButton);
                } else {
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ö–æ–¥–∞
                    const loginButton = document.createElement('button');
                    loginButton.className = 'buy-button';
                    loginButton.textContent = '–í–æ–π–¥–∏—Ç–µ';
                    
                    loginButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        closeShop();
                        showLoginModal();
                    });
                    
                    characterActions.appendChild(loginButton);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                characterItem.appendChild(characterImage);
                characterItem.appendChild(characterName);
                characterItem.appendChild(characterPrice);
                characterItem.appendChild(characterActions);
                
                characterList.appendChild(characterItem);
            });
            
            totalCountDisplay.textContent = CHARACTERS.length;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        function initPlayerImage() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            let characterId = 'default';
            
            if (gameAPI.currentUser) {
                characterId = gameAPI.currentUser.activeCharacter;
            } else {
                characterId = localStorage.getItem('guestActiveCharacter') || 'default';
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
            const character = CHARACTERS.find(char => char.id === characterId);
            if (character) {
                activeCharacter = character;
                player.src = character.image;
                player.style.width = character.width + 'px';
                player.style.height = character.height + 'px';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (character.sounds) {
                    jumpSound.src = character.sounds.jump || SOUNDS.jump;
                    coinSound.src = character.sounds.coin || SOUNDS.coin;
                    gameOverSound.src = character.sounds.gameOver || SOUNDS.gameOver;
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        async function init() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É –∏–∑ localStorage
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                themeToggle.checked = true;
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏–∑ localStorage
            const savedSound = localStorage.getItem('sound') || 'on';
            soundToggle.checked = savedSound === 'on';
            soundEnabled = savedSound === 'on';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            initPlayerImage();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            updateAuthUI();
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞–≥–∞–∑–∏–Ω–∞
            createShopItems();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            await updateLeaderboard();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            themeToggle.addEventListener('change', toggleTheme);
            soundToggle.addEventListener('change', toggleSound);
            musicToggle.addEventListener('click', toggleMusic);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä—ã–∂–∫–∞ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø—Ä–æ–±–µ–ª–∞
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space') {
                    event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                    if (!isJumping && isGameStarted && !isGameOver) {
                        jump();
                    }
                } else if (event.key === 'ArrowUp' && !isJumping && isGameStarted && !isGameOver) {
                    event.preventDefault();
                    jump();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            gameContainer.addEventListener('touchstart', function(e) {
                if (!isJumping && isGameStarted && !isGameOver) {
                    e.preventDefault();
                    jump();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –ø—Ä—ã–∂–∫–∞
            mobileJumpButton.addEventListener('touchstart', function(e) {
                if (!isJumping && isGameStarted && !isGameOver) {
                    e.preventDefault();
                    jump();
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
            startButton.addEventListener('click', function() {
                if (!isGameStarted || isGameOver) {
                    startGame();
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
            restartBtn.addEventListener('click', function() {
                saveScore();
                restartGame();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–≥—Ä—ã –æ–∫–æ–Ω—á–µ–Ω–∞
            gameOverClose.addEventListener('click', function() {
                saveScore();
                closeGameOver();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            shopBtnModal.addEventListener('click', function() {
                saveScore();
                closeGameOver();
                openShop();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞
            shopButton.addEventListener('click', openShop);
            shopClose.addEventListener('click', closeShop);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            loginButton.addEventListener('click', showLoginModal);
            registerButton.addEventListener('click', showRegisterModal);
            loginClose.addEventListener('click', closeLoginModal);
            registerClose.addEventListener('click', closeRegisterModal);
            toRegister.addEventListener('click', function() {
                closeLoginModal();
                showRegisterModal();
            });
            toLogin.addEventListener('click', function() {
                closeRegisterModal();
                showLoginModal();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
            loginSubmit.addEventListener('click', async function() {
                const username = loginUsername.value.trim();
                const password = loginPassword.value;
                
                if (!username || !password) {
                    showMessage(loginMessage, "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
                    return;
                }
                
                const result = await gameAPI.login(username, password);
                
                if (result.success) {
                    showMessage(loginMessage, result.message, "success");
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
                    setTimeout(() => {
                        closeLoginModal();
                        updateAuthUI();
                        createShopItems();
                    }, 1000);
                } else {
                    showMessage(loginMessage, result.message, "error");
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            registerSubmit.addEventListener('click', async function() {
                const username = registerUsername.value.trim();
                const password = registerPassword.value;
                const confirm = registerConfirm.value;
                
                if (!username || !password || !confirm) {
                    showMessage(registerMessage, "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
                    return;
                }
                
                if (password !== confirm) {
                    showMessage(registerMessage, "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç", "error");
                    return;
                }
                
                const result = await gameAPI.register(username, password);
                
                if (result.success) {
                    showMessage(registerMessage, result.message, "success");
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    setTimeout(() => {
                        closeRegisterModal();
                        updateAuthUI();
                        createShopItems();
                    }, 1000);
                } else {
                    showMessage(registerMessage, result.message, "error");
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
            profileButton.addEventListener('click', showProfileModal);
            profileClose.addEventListener('click', closeProfileModal);
            logoutButton.addEventListener('click', function() {
                const result = gameAPI.logout();
                
                if (result.success) {
                    closeProfileModal();
                    updateAuthUI();
                    createShopItems();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
            modalOverlay.addEventListener('click', function(e) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ —Å–∞–º–æ–º –æ–≤–µ—Ä–ª–µ–µ, –∞ –Ω–µ –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                if (e.target === modalOverlay) {
                    closeAllModals();
                }
            });
            
            // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø—Ä–æ–±–µ–ª–∞
            window.addEventListener('keydown', function(e) {
                if(e.code === 'Space' && e.target === document.body) {
                    e.preventDefault();
                }
            });

            // –î–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫—É –ø—Ä—ã–∂–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (isMobileDevice()) {
                mobileJumpButton.style.display = 'block';
            } else {
                mobileJumpButton.style.display = 'none';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = `message ${type}`;
            element.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
        function showLoginModal() {
            loginModal.style.display = 'block';
            modalOverlay.style.display = 'block';
            loginMessage.style.display = 'none';
            loginUsername.focus();
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
        function closeLoginModal() {
            loginModal.style.display = 'none';
            modalOverlay.style.display = 'none';
            loginUsername.value = '';
            loginPassword.value = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegisterModal() {
            registerModal.style.display = 'block';
            modalOverlay.style.display = 'block';
            registerMessage.style.display = 'none';
            registerUsername.focus();
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function closeRegisterModal() {
            registerModal.style.display = 'none';
            modalOverlay.style.display = 'none';
            registerUsername.value = '';
            registerPassword.value = '';
            registerConfirm.value = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        function showProfileModal() {
            if (gameAPI.currentUser) {
                updateProfileModal();
                profileModal.style.display = 'block';
                modalOverlay.style.display = 'block';
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        function closeProfileModal() {
            profileModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function closeAllModals() {
            loginModal.style.display = 'none';
            registerModal.style.display = 'none';
            shopModal.style.display = 'none';
            gameOverScreen.style.display = 'none';
            profileModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        function openShop() {
            shopModal.style.display = 'block';
            modalOverlay.style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
            if (gameAPI.currentUser) {
                shopCoinsDisplay.textContent = gameAPI.currentUser.coins;
            } else {
                shopCoinsDisplay.textContent = '0 (–≥–æ—Å—Ç—å)';
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        function closeShop() {
            shopModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞"
        function closeGameOver() {
            gameOverScreen.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–æ–≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function createObstacle() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (–º–µ–Ω—å—à–∏–π —à–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø)
            const isGroup = Math.random() < 0.12 && score > 400; // –£–º–µ–Ω—å—à–∏–ª —Å 0.15 –¥–æ 0.12
            
            // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            let availableObstacles = [...OBSTACLES];
            
            // –õ–µ—Ç–∞—é—â–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞
            if (score < 600) {
                availableObstacles = availableObstacles.filter(o => !o.isFlying);
            }
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —É–∂–µ –µ—Å—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, –∏–∑–±–µ–≥–∞–µ–º —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö
            const existingObstacles = obstacles.filter(o => o.x > gameContainer.offsetWidth * 0.7); // –£–≤–µ–ª–∏—á–∏–ª —Å 0.6 –¥–æ 0.7
            if (existingObstacles.length > 0) {
                // –ï—Å–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ, —É–º–µ–Ω—å—à–∞–µ–º —à–∞–Ω—Å —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ - —Å –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤
            const obstacleIndex = Math.floor(Math.random() * availableObstacles.length);
            const obstacleType = availableObstacles[obstacleIndex];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤ –≥—Ä—É–ø–ø–µ (–º–∞–∫—Å 2 –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –∏–≥—Ä—ã)
            const count = isGroup && obstacleType.count ? 
                          Math.min(2, Math.floor(Math.random() * obstacleType.count) + 1) : 1;
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ –≤ –≥—Ä—É–ø–ø–µ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ (–±–æ–ª—å—à–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –ø—Ä—ã–∂–∫–∞)
            const spacing = obstacleType.spacing ? obstacleType.spacing * 1.5 : 90; // –£–≤–µ–ª–∏—á–∏–ª —Å 1.2/70 –¥–æ 1.5/90
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–∂–¥–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ
            for (let i = 0; i < count; i++) {
                const obstacle = document.createElement('img');
                obstacle.src = obstacleType.image;
                obstacle.style.width = obstacleType.width + 'px';
                obstacle.style.height = obstacleType.height + 'px';
                obstacle.classList.add('obstacle');
                
                // –ë–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–ª—é—Å —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –≥—Ä—É–ø–ø
                let posX = gameContainer.offsetWidth + (i * spacing);
                obstacle.style.left = posX + 'px';
                
                // –í—ã—Å–æ—Ç–∞ –¥–ª—è –ª–µ—Ç–∞—é—â–∏—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                let posY = 0;
                if (obstacleType.isFlying) {
                    posY = Math.floor(Math.random() * 
                           (obstacleType.maxHeight - obstacleType.minHeight)) + 
                           obstacleType.minHeight;
                    obstacle.style.bottom = posY + 'px';
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤ DOM
                gameContainer.appendChild(obstacle);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
                obstacles.push({
                    element: obstacle,
                    type: obstacleType.id,
                    x: posX,
                    y: posY,
                    width: obstacleType.width,
                    height: obstacleType.height,
                    hitboxWidth: obstacleType.hitboxWidth,
                    hitboxHeight: obstacleType.hitboxHeight,
                    speed: obstacleType.speed || 1.0,
                    isFlying: obstacleType.isFlying || false
                });
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–µ—Ç–∫–∏ —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–æ–Ω–µ—Ç
        function createCoin() {
            // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –º–æ–Ω–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
            let coinType = COINS[0]; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—Ä–æ–Ω–∑–æ–≤–∞—è (–æ–±—ã—á–Ω–∞—è)
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ —Ä–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞
            const rnd = Math.random();
            
            if (rnd < 0.1 && score > 500) { // 10% —à–∞–Ω—Å –∑–æ–ª–æ—Ç–æ–π –ø–æ—Å–ª–µ 500 –æ—á–∫–æ–≤
                coinType = COINS[2]; // –ó–æ–ª–æ—Ç–∞—è
            } else if (rnd < 0.3 && score > 200) { // 20% —à–∞–Ω—Å —Å–µ—Ä–µ–±—Ä—è–Ω–æ–π –ø–æ—Å–ª–µ 200 –æ—á–∫–æ–≤
                coinType = COINS[1]; // –°–µ—Ä–µ–±—Ä—è–Ω–∞—è
            }
            
            const coin = document.createElement('img');
            coin.src = coinType.image;
            coin.style.width = coinType.width + 'px';
            coin.style.height = coinType.height + 'px';
            coin.classList.add('coin');
            coin.style.left = gameContainer.offsetWidth + 'px';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ –ª–∏–Ω–∏—è –º–æ–Ω–µ—Ç
            const isLine = Math.random() < 0.3 && score > 300; // 30% —à–∞–Ω—Å –ª–∏–Ω–∏–∏ –ø–æ—Å–ª–µ 300 –æ—á–∫–æ–≤
            const lineCount = isLine ? Math.floor(Math.random() * 3) + 3 : 1; // 3-5 –º–æ–Ω–µ—Ç –≤ –ª–∏–Ω–∏–∏
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –º–æ–Ω–µ—Ç–∫–∏ (–∞–¥–∞–ø—Ç–∏—Ä—É–µ–º –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
            const containerHeight = gameContainer.offsetHeight;
            const height = Math.floor(Math.random() * (containerHeight / 2.5)) + 40;
            
            // –°–æ–∑–¥–∞–µ–º –ª–∏–Ω–∏—é –º–æ–Ω–µ—Ç –∏–ª–∏ –æ–¥–∏–Ω–æ—á–Ω—É—é –º–æ–Ω–µ—Ç—É
            for (let i = 0; i < lineCount; i++) {
                const coinElement = i === 0 ? coin : coin.cloneNode(true);
                const spacing = 40; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –º–æ–Ω–µ—Ç–∞–º–∏ –≤ –ª–∏–Ω–∏–∏
                
                coinElement.style.left = (gameContainer.offsetWidth + i * spacing) + 'px';
                coinElement.style.bottom = height + 'px';
                
                gameContainer.appendChild(coinElement);
                
                coins.push({
                    element: coinElement,
                    type: coinType.id,
                    x: gameContainer.offsetWidth + i * spacing,
                    y: height,
                    width: coinType.width,
                    height: coinType.height,
                    hitboxWidth: coinType.hitboxWidth,
                    hitboxHeight: coinType.hitboxHeight,
                    value: coinType.value || 1,
                    collected: false
                });
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
        function createBonus() {
            // –ë–æ–Ω—É—Å—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞
            if (Math.random() > 0.05 || score < 500) return; // 5% —à–∞–Ω—Å –ø–æ—Å–ª–µ 500 –æ—á–∫–æ–≤
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –±–æ–Ω—É—Å
            const bonusType = BONUSES[Math.floor(Math.random() * BONUSES.length)];
            
            const bonus = document.createElement('img');
            bonus.src = bonusType.image;
            bonus.style.width = bonusType.width + 'px';
            bonus.style.height = bonusType.height + 'px';
            bonus.classList.add('bonus');
            bonus.style.left = gameContainer.offsetWidth + 'px';
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –±–æ–Ω—É—Å–∞
            const containerHeight = gameContainer.offsetHeight;
            const height = Math.floor(Math.random() * (containerHeight / 3)) + 60;
            bonus.style.bottom = height + 'px';
            
            gameContainer.appendChild(bonus);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤
            bonuses.push({
                element: bonus,
                type: bonusType.id,
                effect: bonusType.effect,
                duration: bonusType.duration,
                x: gameContainer.offsetWidth,
                y: height,
                width: bonusType.width,
                height: bonusType.height,
                hitboxWidth: bonusType.hitboxWidth,
                hitboxHeight: bonusType.hitboxHeight,
                collected: false
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            score = 0;
            coinCount = 0;
            gameSpeed = 10; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 8 –¥–æ 10 - –Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞
            backgroundPos = 0;
            currentLevel = 1;
            gameStartTime = Date.now();
            gameTime = 0;
            obstacles = [];
            coins = [];
            bonuses = [];
            isGameOver = false;
            isGameStarted = true;
            debugMode = false;
            hasShield = false;
            hasMagnet = false;
            hasSlowMotion = false;
            clearTimeout(shieldTimer);
            clearTimeout(magnetTimer);
            clearTimeout(slowTimer);
            
            if (isMobileDevice()) {
            mobileJumpButton.style.display = 'block';
            } else {
                mobileJumpButton.style.display = 'none';
            }
            
            document.querySelectorAll('.obstacle, .coin, .bonus, .explosion, .floating-text, .level-up-container, [id^="player-hitbox"], [id^="obstacle-hitbox"], [id^="coin-hitbox"], [id^="bonus-hitbox"]').forEach(el => el.remove());
            
            scoreDisplay.textContent = score;
            coinsDisplay.textContent = coinCount;
            gameOverScreen.style.display = 'none';
            modalOverlay.style.display = 'none';
            
            if (player) {
                player.style.filter = 'none';
            }
            
            // –ù–∞—á–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ - –∫–∞–∫ –≤ Chrome Dino
            nextObstacleTime = performance.now() + 2000; // –ü–µ—Ä–≤–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ —á—É—Ç—å –ø–æ–∑–∂–µ
            nextCoinTime = performance.now() + 800; 
            nextBonusTime = performance.now() + 12000; // –ë–æ–Ω—É—Å—ã —Ä–µ–∂–µ –≤ –Ω–∞—á–∞–ª–µ
            
            obstacleInterval = 1400; // –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è update() (–£–º–µ–Ω—å—à–µ–Ω–æ —Å 1500)
            coinInterval = 1000; // (–£–º–µ–Ω—å—à–µ–Ω–æ —Å 1200)
            bonusInterval = 12000; // (–£–º–µ–Ω—å—à–µ–Ω–æ —Å 15000)

            if (soundEnabled && !musicPlaying) {
                toggleMusic();
            }
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
            if (soundEnabled) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∑–≤—É–∫ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                let soundSrc = null;
                
                if (activeCharacter && activeCharacter.sounds && activeCharacter.sounds.gameStart) {
                    soundSrc = getRandomSound(activeCharacter.sounds.gameStart);
                } else if (SOUNDS.gameStart) {
                    soundSrc = getRandomSound(SOUNDS.gameStart);
                }
                
                if (soundSrc) {
                    gameStartSound.src = soundSrc;
                    gameStartSound.volume = SOUND_VOLUME.effects;
                    gameStartSound.currentTime = 0;
                    gameStartSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                }
            }

            showStartAnimation();
            
            // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π gameLoop, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
            cancelAnimationFrame(gameLoop);
            // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop = requestAnimationFrame(update);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é
        function showStartAnimation() {
            const startCountdown = document.createElement('div');
            startCountdown.className = 'start-countdown';
            startCountdown.style.position = 'absolute';
            startCountdown.style.top = '50%';
            startCountdown.style.left = '50%';
            startCountdown.style.transform = 'translate(-50%, -50%)';
            startCountdown.style.color = '#fff';
            startCountdown.style.fontSize = '48px';
            startCountdown.style.fontWeight = 'bold';
            startCountdown.style.textShadow = '2px 2px 4px rgba(0, 0, 0, 0.5)';
            startCountdown.style.zIndex = '5';
            startCountdown.style.transition = 'transform 0.25s, opacity 0.25s'; // –£—Å–∫–æ—Ä–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—é –≤ 2 —Ä–∞–∑–∞
            startCountdown.textContent = '3';
            
            gameContainer.appendChild(startCountdown);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞ (—É—Å–∫–æ—Ä–µ–Ω–∞ –≤ 2 —Ä–∞–∑–∞)
            setTimeout(() => {
                startCountdown.style.transform = 'translate(-50%, -50%) scale(1.5)';
                startCountdown.style.opacity = '0';
                
                setTimeout(() => {
                    startCountdown.style.transform = 'translate(-50%, -50%) scale(1)';
                    startCountdown.style.opacity = '1';
                    startCountdown.textContent = '2';
                    
                    setTimeout(() => {
                        startCountdown.style.transform = 'translate(-50%, -50%) scale(1.5)';
                        startCountdown.style.opacity = '0';
                        
                        setTimeout(() => {
                            startCountdown.style.transform = 'translate(-50%, -50%) scale(1)';
                            startCountdown.style.opacity = '1';
                            startCountdown.textContent = '1';
                            
                            setTimeout(() => {
                                startCountdown.style.transform = 'translate(-50%, -50%) scale(1.5)';
                                startCountdown.style.opacity = '0';
                                
                                setTimeout(() => {
                                    startCountdown.style.transform = 'translate(-50%, -50%) scale(1)';
                                    startCountdown.style.opacity = '1';
                                    startCountdown.textContent = 'GO!';
                                    startCountdown.style.color = activeCharacter.color || '#4285f4';
                                    
                                    setTimeout(() => {
                                        startCountdown.style.transform = 'translate(-50%, -50%) scale(2)';
                                        startCountdown.style.opacity = '0';
                                        
                                        setTimeout(() => {
                                            startCountdown.remove();
                                        }, 250);
                                    }, 250);
                                }, 250);
                            }, 250);
                        }, 250);
                    }, 250);
                }, 250);
            }, 250);
        }
        
        // –ü—Ä—ã–∂–æ–∫ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ - –ú–µ—Ö–∞–Ω–∏–∫–∞ Chrome Dino
        function jump() {
            if (!activeCharacter || isJumping) return;
            
            isJumping = true;
            
            const jumpHeight = activeCharacter.jumpHeight || 100; // –ë–∞–∑–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ –ø—Ä—ã–∂–∫–∞ Chrome Dino
            const jumpDuration = 600; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä—ã–∂–∫–∞ –≤ Chrome Dino
            const gravityFactor = 1.6; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –¥–ª—è –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è
            
            let jumpStyle = document.getElementById('jump-style');
            if (!jumpStyle) {
                jumpStyle = document.createElement('style');
                jumpStyle.id = 'jump-style';
                document.head.appendChild(jumpStyle);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä—ã–∂–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º cubic-bezier, –ø–æ—Ö–æ–∂–µ–π –Ω–∞ Chrome Dino
            jumpStyle.textContent = `
                @keyframes jump {
                    0% { bottom: 0; animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1); }
                    50% { bottom: ${jumpHeight}px; }
                    100% { bottom: 0; animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33); } 
                }
                .jumping {
                    animation: jump ${jumpDuration}ms linear;
                    will-change: bottom;
                }
            `;
            
            player.classList.add('jumping');
            
            if (soundEnabled) {
                const soundSrc = activeCharacter.sounds?.jump || SOUNDS.jump;
                if (jumpSound.src !== soundSrc) {
                    jumpSound.src = soundSrc;
                }
                jumpSound.volume = SOUND_VOLUME.effects;
                jumpSound.currentTime = 0;
                jumpSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            setTimeout(() => {
                player.classList.remove('jumping');
                isJumping = false;
            }, jumpDuration);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤—ã—Å–æ—Ç—ã –ø—Ä—ã–∂–∫–∞ - –ú–µ—Ö–∞–Ω–∏–∫–∞ Chrome Dino
        function getJumpHeight() {
            if (!isJumping) return 0;

            const jumpDuration = 600;
            const jumpHeight = activeCharacter.jumpHeight || 100;
            const timeInJump = Date.now() % jumpDuration; // –í—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞ —Ç–µ–∫—É—â–µ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä—ã–∂–∫–∞
            const progress = timeInJump / jumpDuration;

            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–±–æ–ª–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏, –∫–∞–∫ –≤ Chrome Dino
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –ø–∞—Ä–∞–±–æ–ª—É: y = 4 * h * x * (1 - x), –≥–¥–µ h - –º–∞–∫—Å –≤—ã—Å–æ—Ç–∞, x - –ø—Ä–æ–≥—Ä–µ—Å—Å (0 –¥–æ 1)
            const currentHeight = 4 * jumpHeight * progress * (1 - progress);
            
            return Math.max(0, currentHeight); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—ã—Å–æ—Ç–∞ –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å —É—á–µ—Ç–æ–º —Ö–∏—Ç–±–æ–∫—Å–æ–≤ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä—É
        function checkCollisions() {
            if (!activeCharacter) return;
            
            // –°–æ–∑–¥–∞–µ–º —Ö–∏—Ç–±–æ–∫—Å –¥–ª—è –∏–≥—Ä–æ–∫–∞ —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞–π—Ç–∞ –¥–ª—è –±–æ–ª—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
            const playerOffset = (activeCharacter.width - activeCharacter.hitboxWidth) / 2;
            const playerRect = {
                x: 50 + playerOffset, // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å
                y: isJumping ? getJumpHeight() : 0,
                width: activeCharacter.hitboxWidth,
                height: activeCharacter.hitboxHeight
            };
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –∏–≥—Ä–æ–∫–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
            if (debugMode) {
                drawHitbox(playerRect.x, playerRect.y, playerRect.width, playerRect.height, 'player-hitbox', 'rgba(0, 255, 0, 0.5)');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
            for (let i = 0; i < obstacles.length; i++) {
                const obstacle = obstacles[i];
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞–π—Ç–∞ –¥–ª—è –±–æ–ª—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
                const obstacleOffset = (obstacle.width - obstacle.hitboxWidth) / 2;
                
                // –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è –ª–µ—Ç–∞—é—â–∏—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                const obstacleY = obstacle.isFlying ? obstacle.y : 0;
                
                const obstacleRect = {
                    x: obstacle.x + obstacleOffset, // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å
                    y: obstacleY,
                    width: obstacle.hitboxWidth,
                    height: obstacle.hitboxHeight
                };
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
                if (debugMode) {
                    drawHitbox(obstacleRect.x, obstacleY, obstacleRect.width, obstacleRect.height, 
                              `obstacle-hitbox-${i}`, 'rgba(255, 0, 0, 0.5)');
                }
                
                // –î–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –∏–≥—Ä—ã (5% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ö–∏—Ç–±–æ–∫—Å–∞)
                const tolerance = Math.min(obstacleRect.width, obstacleRect.height) * 0.05;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤ —Å —É—á–µ—Ç–æ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏
                if (
                    playerRect.x + tolerance < obstacleRect.x + obstacleRect.width - tolerance &&
                    playerRect.x + playerRect.width - tolerance > obstacleRect.x + tolerance &&
                    playerRect.y + tolerance < obstacleRect.y + obstacleRect.height - tolerance &&
                    playerRect.y + playerRect.height - tolerance > obstacleRect.y + tolerance
                ) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —â–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä—É
                    if (hasShield) {
                        useShield(obstacle);
                        return;
                    }
                    
                    gameOver();
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç–æ–∫
            for (let i = 0; i < coins.length; i++) {
                const coin = coins[i];
                if (coin.collected) continue;
                
                const coinRect = {
                    x: coin.x,
                    y: coin.y,
                    width: coin.hitboxWidth,
                    height: coin.hitboxHeight
                };
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –º–æ–Ω–µ—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
                if (debugMode) {
                    drawHitbox(coin.x, coin.y, coinRect.width, coinRect.height, 
                              `coin-hitbox-${i}`, 'rgba(255, 255, 0, 0.5)');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤
                if (
                    playerRect.x < coinRect.x + coinRect.width &&
                    playerRect.x + playerRect.width > coinRect.x &&
                    playerRect.y < coinRect.y + coinRect.height &&
                    playerRect.y + playerRect.height > coinRect.y
                ) {
                    collectCoin(coin);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –±–æ–Ω—É—Å–æ–≤
            for (let i = 0; i < bonuses.length; i++) {
                const bonus = bonuses[i];
                if (bonus.collected) continue;
                
                const bonusRect = {
                    x: bonus.x,
                    y: bonus.y,
                    width: bonus.hitboxWidth,
                    height: bonus.hitboxHeight
                };
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –±–æ–Ω—É—Å–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
                if (debugMode) {
                    drawHitbox(bonus.x, bonus.y, bonusRect.width, bonusRect.height, 
                              `bonus-hitbox-${i}`, 'rgba(0, 255, 255, 0.5)');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤
                if (
                    playerRect.x < bonusRect.x + bonusRect.width &&
                    playerRect.x + playerRect.width > bonusRect.x &&
                    playerRect.y < bonusRect.y + bonusRect.height &&
                    playerRect.y + playerRect.height > bonusRect.y
                ) {
                    collectBonus(bonus);
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function drawHitbox(x, y, width, height, id, color) {
            let hitbox = document.getElementById(id);
            if (!hitbox) {
                hitbox = document.createElement('div');
                hitbox.id = id;
                hitbox.style.position = 'absolute';
                hitbox.style.pointerEvents = 'none';
                hitbox.style.zIndex = '100';
                gameContainer.appendChild(hitbox);
            }
            
            hitbox.style.left = x + 'px';
            hitbox.style.bottom = y + 'px';
            hitbox.style.width = width + 'px';
            hitbox.style.height = height + 'px';
            hitbox.style.backgroundColor = color;
            hitbox.style.border = '1px solid white';
        }
        
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —â–∏—Ç–∞ –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏
        function useShield(obstacle) {
            hasShield = false;
            
            // –£–¥–∞–ª—è–µ–º —â–∏—Ç
            const shieldElement = document.getElementById('player-shield');
            if (shieldElement) shieldElement.remove();
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä —â–∏—Ç–∞
            clearTimeout(shieldTimer);
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ, —Å –∫–æ—Ç–æ—Ä—ã–º —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å
            const obstacleIndex = obstacles.indexOf(obstacle);
            if (obstacleIndex !== -1) {
                obstacle.element.remove();
                obstacles.splice(obstacleIndex, 1);
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.position = 'absolute';
            explosion.style.left = obstacle.x + 'px';
            explosion.style.bottom = (obstacle.isFlying ? obstacle.y : 0) + 'px';
            explosion.style.width = obstacle.width * 1.5 + 'px';
            explosion.style.height = obstacle.height * 1.5 + 'px';
            explosion.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
            explosion.style.borderRadius = '50%';
            explosion.style.zIndex = '3';
            explosion.style.pointerEvents = 'none';
            explosion.style.transition = 'transform 0.3s, opacity 0.3s';
            explosion.style.opacity = '1';
            explosion.style.transform = 'scale(0.5)';
            
            gameContainer.appendChild(explosion);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞
            setTimeout(() => {
                explosion.style.transform = 'scale(2)';
                explosion.style.opacity = '0';
            }, 50);
            
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                explosion.remove();
            }, 350);
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
            if (soundEnabled && SOUNDS.shieldEnd) {
                const shieldEndSound = new Audio(SOUNDS.shieldEnd);
                shieldEndSound.volume = SOUND_VOLUME.effects;
                shieldEndSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            // –î–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å –∫ —Å—á–µ—Ç—É
            score += 100;
            scoreDisplay.textContent = score;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é +100
            showFloatingText('+100', obstacle.x, (obstacle.isFlying ? obstacle.y : 30), '#00ffff');
        }
        
        // –°–±–æ—Ä –º–æ–Ω–µ—Ç–∫–∏ —Å —É—á–µ—Ç–æ–º –µ–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        function collectCoin(coin) {
            coin.collected = true;
            coin.element.style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const coinValue = coin.value || 1;
            coinCount += coinValue;
            coinsDisplay.textContent = coinCount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é +–• –Ω–∞–¥ –º–æ–Ω–µ—Ç–æ–π
            if (coinValue > 1) {
                showFloatingText(`+${coinValue}`, coin.x, coin.y, coin.type === 'gold' ? '#ffd700' : '#c0c0c0');
            }
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç—ã (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞)
            if (soundEnabled) {
                const soundSrc = activeCharacter && activeCharacter.sounds && activeCharacter.sounds.coin ?
                              activeCharacter.sounds.coin : SOUNDS.coin;
                                
                if (coinSound.src !== soundSrc) {
                    coinSound.src = soundSrc;
                }
                
                coinSound.volume = SOUND_VOLUME.effects;
                coinSound.currentTime = 0;
                coinSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç –∑–∞ –º–æ–Ω–µ—Ç–∫—É (—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã = —Ä–∞–∑–Ω—ã–µ –æ—á–∫–∏)
            const scoreBonus = coinValue * 50;
            score += scoreBonus;
            scoreDisplay.textContent = score;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        function checkLevelUp() {
            // –ö–∞–∂–¥—ã–µ 1000 –æ—á–∫–æ–≤ - –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (—É–≤–µ–ª–∏—á–µ–Ω–æ —Å 500 –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–µ–¥–ª–µ–Ω–Ω–æ–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é –æ—á–∫–æ–≤)
            const newLevel = Math.floor(score / 1000) + 1;
            
            if (newLevel > currentLevel) {
                currentLevel = newLevel;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
                showLevelUpAnimation(newLevel);
                
                // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —É—Ä–æ–≤–Ω—è
                if (soundEnabled && SOUNDS.levelUp) {
                    const levelUpSound = new Audio(SOUNDS.levelUp);
                    levelUpSound.volume = SOUND_VOLUME.effects;
                    levelUpSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                }
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–∏–π —Ç–µ–∫—Å—Ç
        function showFloatingText(text, x, y, color = '#ffffff') {
            const floatingText = document.createElement('div');
            floatingText.className = 'floating-text';
            floatingText.textContent = text;
            floatingText.style.position = 'absolute';
            floatingText.style.left = x + 'px';
            floatingText.style.bottom = y + 'px';
            floatingText.style.color = color;
            floatingText.style.fontSize = '18px';
            floatingText.style.fontWeight = 'bold';
            floatingText.style.textShadow = '1px 1px 2px rgba(0, 0, 0, 0.5)';
            floatingText.style.zIndex = '5';
            floatingText.style.pointerEvents = 'none';
            floatingText.style.transition = 'transform 0.8s, opacity 0.8s';
            floatingText.style.opacity = '1';
            
            gameContainer.appendChild(floatingText);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—ä–µ–º–∞ –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            setTimeout(() => {
                floatingText.style.transform = 'translateY(-30px)';
                floatingText.style.opacity = '0';
            }, 50);
            
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                floatingText.remove();
            }, 800);
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        function showLevelUpAnimation(level) {
            const levelUpContainer = document.createElement('div');
            levelUpContainer.className = 'level-up-container';
            levelUpContainer.style.position = 'absolute';
            levelUpContainer.style.top = '50%';
            levelUpContainer.style.left = '50%';
            levelUpContainer.style.transform = 'translate(-50%, -50%)';
            levelUpContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            levelUpContainer.style.color = '#FFD700';
            levelUpContainer.style.padding = '15px 30px';
            levelUpContainer.style.borderRadius = '10px';
            levelUpContainer.style.fontSize = '24px';
            levelUpContainer.style.fontWeight = 'bold';
            levelUpContainer.style.zIndex = '10';
            levelUpContainer.style.pointerEvents = 'none';
            levelUpContainer.style.opacity = '0';
            levelUpContainer.style.transition = 'opacity 0.3s';
            levelUpContainer.textContent = `–£–†–û–í–ï–ù–¨ ${level}!`;
            
            gameContainer.appendChild(levelUpContainer);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            setTimeout(() => levelUpContainer.style.opacity = '1', 50);
            setTimeout(() => levelUpContainer.style.opacity = '0', 1500);
            setTimeout(() => levelUpContainer.remove(), 1800);
        }
        
        // –°–±–æ—Ä –±–æ–Ω—É—Å–∞
        function collectBonus(bonus) {
            bonus.collected = true;
            bonus.element.style.display = 'none';
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —Å–±–æ—Ä–∞ –±–æ–Ω—É—Å–∞
            if (soundEnabled && SOUNDS.bonus) {
                const bonusSound = new Audio(SOUNDS.bonus);
                bonusSound.volume = SOUND_VOLUME.effects;
                bonusSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –±–æ–Ω—É—Å–∞
            showFloatingText(bonus.effect.toUpperCase(), bonus.x, bonus.y, '#00ffff');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —ç—Ñ—Ñ–µ–∫—Ç –±–æ–Ω—É—Å–∞
            activateBonus(bonus.effect, bonus.duration);
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–æ–Ω—É—Å–∞
        function activateBonus(effect, duration) {
            switch (effect) {
                case 'shield':
                    hasShield = true;
                    
                    // –°–æ–∑–¥–∞–µ–º —â–∏—Ç –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞
                    const shield = document.createElement('div');
                    shield.id = 'player-shield';
                    shield.style.position = 'absolute';
                    shield.style.left = '50px';
                    shield.style.bottom = '0';
                    shield.style.width = (activeCharacter.width + 20) + 'px';
                    shield.style.height = (activeCharacter.height + 20) + 'px';
                    shield.style.borderRadius = '50%';
                    shield.style.border = '3px solid #00ffff';
                    shield.style.boxShadow = '0 0 10px #00ffff';
                    shield.style.zIndex = '1';
                    shield.style.pointerEvents = 'none';
                    
                    gameContainer.appendChild(shield);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
                    shieldTimer = setTimeout(() => {
                        hasShield = false;
                        const shieldElement = document.getElementById('player-shield');
                        if (shieldElement) shieldElement.remove();
                        
                        // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
                        if (soundEnabled && SOUNDS.shieldEnd) {
                            const shieldEndSound = new Audio(SOUNDS.shieldEnd);
                            shieldEndSound.volume = SOUND_VOLUME.effects;
                            shieldEndSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                        }
                    }, duration);
                    break;
                    
                case 'slow':
                    const previousSpeed = gameSpeed;
                    gameSpeed *= 0.5; // –ó–∞–º–µ–¥–ª—è–µ–º –∏–≥—Ä—É
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                    gameContainer.style.filter = 'sepia(0.5)';
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                    slowTimer = setTimeout(() => {
                        gameSpeed = previousSpeed;
                        gameContainer.style.filter = 'none';
                    }, duration);
                    break;
                    
                case 'magnet':
                    hasMagnet = true;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –º–∞–≥–Ω–∏—Ç–∞
                    player.style.filter = 'brightness(1.2) drop-shadow(0 0 5px gold)';
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –º–∞–≥–Ω–∏—Ç–∞
                    magnetTimer = setTimeout(() => {
                        hasMagnet = false;
                        player.style.filter = 'none';
                    }, duration);
                    break;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã - –º–µ—Ö–∞–Ω–∏–∫–∞ –∫–∞–∫ –≤ Chrome Dino
        function update(timestamp) {
            if (isGameOver) return;
            
            // 1. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤ (–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—Ä–µ–º–µ–Ω–∏/—Å–∫–æ—Ä–æ—Å—Ç–∏)
            // –í Chrome Dino —Å—á–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∂–¥—ã–µ 100–º—Å –ø—Ä–∏ –±–∞–∑–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
            // –∏ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è —Å —Ä–æ—Å—Ç–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–≥—Ä—ã.
            
            // –ë–æ–ª–µ–µ —É–º–µ—Ä–µ–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç–∞ 
            const SCORE_INCREASE_FACTOR = 0.08; // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            
            // –†–∞—Å—á–µ—Ç –¥–µ–ª—å—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏ –¥–ª—è –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç–∞
            const now = timestamp || performance.now();
            if (!update.lastTime) update.lastTime = now;
            const deltaTime = now - update.lastTime;
            update.lastTime = now;
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø—Ä–∏—Ä–æ—Å—Ç –æ—á–∫–æ–≤ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            const frameTimeFactor = deltaTime / 16.7; // 16.7–º—Å ‚âà 60FPS
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Math.ceil –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –º–∏–Ω–∏–º—É–º –Ω–∞ 1, –Ω–æ —Ç–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–µ ~4 –∫–∞–¥—Ä–∞
            if (Math.random() < 0.25) { // –ü—Ä–∏–º–µ—Ä–Ω–æ 1 —Ä–∞–∑ –≤ 4 –∫–∞–¥—Ä–∞
                score += Math.ceil(gameSpeed * SCORE_INCREASE_FACTOR * frameTimeFactor);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            scoreDisplay.textContent = score;
            
            // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
            gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            // 2. –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–≥—Ä—ã (–∫–∞–∫ –≤ Chrome Dino)
            const BASE_SPEED = 12; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 10 –¥–æ 12 - –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–ø–∏–∫—Å–µ–ª–µ–π/–∫–∞–¥—Ä)
            const MAX_SPEED = 22; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 19 –¥–æ 22 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            const ACCELERATION = 0.004; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.003 –¥–æ 0.004 - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è
            
            // –ü–ª–∞–≤–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π
            if (gameSpeed < MAX_SPEED) {
                gameSpeed += ACCELERATION * frameTimeFactor;
                gameSpeed = Math.min(gameSpeed, MAX_SPEED); // –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ–º –º–∞–∫—Å–∏–º—É–º
            }
            
            // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            
            // 3. –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (–∫–∞–∫ –≤ Chrome Dino)
            // –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å —Ä–æ—Å—Ç–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ –∏–º–µ–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–µ–ª
            const BASE_OBSTACLE_INTERVAL_MS = 1250; // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 1400 –¥–æ 1250 - –Ω–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º—Å
            const MIN_OBSTACLE_INTERVAL_MS = 500; // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 550 –¥–æ 500 - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
            const INTERVAL_SPEED_FACTOR = 60; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 55 –¥–æ 60 - –Ω–∞ —Å–∫–æ–ª—å–∫–æ –º—Å —É–º–µ–Ω—å—à–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Å–∫–æ—Ä–æ—Å—Ç–∏
            
            obstacleInterval = Math.max(
                MIN_OBSTACLE_INTERVAL_MS,
                BASE_OBSTACLE_INTERVAL_MS - (gameSpeed - BASE_SPEED) * INTERVAL_SPEED_FACTOR
            );
            
            // 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            if (timestamp >= nextObstacleTime) {
                createObstacle();
                
                // –°–ª–µ–¥—É—é—â–µ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ obstacleInterval + –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–Ω–¥–æ–º
                // –†–∞–Ω–¥–æ–º —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å —Ä–æ—Å—Ç–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ (–∫–∞–∫ –≤ Chrome Dino)
                const randomFactor = Math.max(0, 1 - (gameSpeed / MAX_SPEED)); // –û—Ç 1 –¥–æ 0
                const randomOffset = (Math.random() * obstacleInterval * 0.5) * randomFactor; // –£–º–µ–Ω—å—à–∞—é—â–∏–π—Å—è —Ä–∞–Ω–¥–æ–º
                nextObstacleTime = timestamp + obstacleInterval + randomOffset;
            }
            
            // 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–Ω–µ—Ç–æ–∫ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ, –Ω–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
            if (timestamp >= nextCoinTime) {
                createCoin();
                nextCoinTime = timestamp + coinInterval + (Math.random() * 800 - 400); // –£–º–µ–Ω—å—à–µ–Ω –¥–∏–∞–ø–∞–∑–æ–Ω —Ä–∞–Ω–¥–æ–º–∞
            }
            
            // 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–Ω—É—Å–æ–≤ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ)
            if (timestamp >= nextBonusTime) {
                createBonus();
                nextBonusTime = timestamp + bonusInterval + Math.random() * 4000; // –£–º–µ–Ω—å—à–µ–Ω –¥–∏–∞–ø–∞–∑–æ–Ω —Ä–∞–Ω–¥–æ–º–∞
            }
            
            // 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –æ–±—ä–µ–∫—Ç–æ–≤ (–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, –º–æ–Ω–µ—Ç—ã, –±–æ–Ω—É—Å—ã)
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            for (let i = obstacles.length - 1; i >= 0; i--) { // –ò—Ç–µ—Ä–∞—Ü–∏—è —Å –∫–æ–Ω—Ü–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
                const obstacle = obstacles[i];
                obstacle.x -= gameSpeed * (obstacle.speed || 1.0); // –£—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                obstacle.element.style.left = obstacle.x + 'px';
                
                if (obstacle.x < -obstacle.width) {
                    obstacle.element.remove();
                    obstacles.splice(i, 1);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç–æ–∫
            for (let i = coins.length - 1; i >= 0; i--) {
                const coin = coins[i];
                if (coin.collected) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–µ
                
                // –ü—Ä–∏—Ç—è–≥–∏–≤–∞–Ω–∏–µ –º–∞–≥–Ω–∏—Ç–æ–º
                if (hasMagnet) {
                    const playerCenterX = 50 + (activeCharacter.width / 2);
                    const playerCenterY = (isJumping ? getJumpHeight() : 0) + (activeCharacter.height / 2);
                    const coinCenterX = coin.x + (coin.width / 2);
                    const coinCenterY = coin.y + (coin.height / 2);
                    const dx = playerCenterX - coinCenterX;
                    const dy = playerCenterY - coinCenterY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const MAGNET_RADIUS = 150;
                    const MAGNET_STRENGTH = 0.1;
                    
                    if (distance < MAGNET_RADIUS) {
                        coin.x += dx * MAGNET_STRENGTH;
                        coin.y += dy * MAGNET_STRENGTH;
                    } else {
                        coin.x -= gameSpeed;
                    }
                } else {
                    coin.x -= gameSpeed;
                }
                
                coin.element.style.left = coin.x + 'px';
                coin.element.style.bottom = coin.y + 'px';
                
                if (coin.x < -coin.width) {
                    coin.element.remove();
                    coins.splice(i, 1);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
            for (let i = bonuses.length - 1; i >= 0; i--) {
                const bonus = bonuses[i];
                if(bonus.collected) continue;
                bonus.x -= gameSpeed;
                bonus.element.style.left = bonus.x + 'px';
                
                if (bonus.x < -bonus.width) {
                    bonus.element.remove();
                    bonuses.splice(i, 1);
                }
            }
            
            // 8. –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω
            updateBackground();
            
            // 9. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
            checkCollisions();
            
            // 10. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            if (!isGameOver) {
            gameLoop = requestAnimationFrame(update);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –¥–≤–∏–∂–µ–Ω–∏—è
        function updateBackground() {
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ñ–æ–Ω–∞ –≤ —Å—Ç–∏–ª–µ Chrome –¥–∏–Ω–æ–∑–∞–≤—Ä–∏–∫–∞
            backgroundPos -= gameSpeed * 0.7; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.6 –¥–æ 0.7 - —Ñ–æ–Ω –¥–≤–∏–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é, –∫–æ–≥–¥–∞ –æ–Ω–∞ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            if (backgroundPos <= -1000) { // –®–∏—Ä–∏–Ω–∞ —Ñ–æ–Ω–∞
                backgroundPos = 0;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ñ–æ–Ω–∞
            gameContainer.style.backgroundPosition = `${backgroundPos}px bottom`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ–∏ —Ç—Ä–µ–∫–∞ –¥–ª—è –ø–∞—Ä–∞–ª–ª–∞–∫—Å-—ç—Ñ—Ñ–µ–∫—Ç–∞
            if (document.getElementById('track-grass')) {
                document.getElementById('track-grass').style.transform = `translateX(${backgroundPos * 0.9}px)`; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.8 –¥–æ 0.9
            }
            if (document.getElementById('track-footprints')) {
                document.getElementById('track-footprints').style.transform = `translateX(${backgroundPos * 1.1}px)`; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.0 –¥–æ 1.1
            }
            if (document.getElementById('track-leaves')) {
                document.getElementById('track-leaves').style.transform = `translateX(${backgroundPos * 0.7}px)`; // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 0.6 –¥–æ 0.7
            }
        }
        
        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
        async function gameOver() {
            isGameOver = true;
            isGameStarted = false;
            cancelAnimationFrame(gameLoop);
            
            // –ü—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä—ã–∂–∫–∞
            mobileJumpButton.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (gameAPI.currentUser) {
                await gameAPI.updateUserStats(score, coinCount);
                updateAuthUI();
            }
            
            finalScoreDisplay.textContent = score;
            finalCoinsDisplay.textContent = coinCount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞"
            gameOverScreen.style.display = 'block';
            modalOverlay.style.display = 'block';
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
            if (soundEnabled) {
                backgroundMusic.pause();
                musicPlaying = false;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∑–≤—É–∫ –ø–æ—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                let soundSrc = null;
                
                if (activeCharacter && activeCharacter.sounds && activeCharacter.sounds.gameOver) {
                    soundSrc = getRandomSound(activeCharacter.sounds.gameOver);
                } else if (SOUNDS.gameOver) {
                    soundSrc = getRandomSound(SOUNDS.gameOver);
                }
                
                if (soundSrc) {
                    gameOverSound.src = soundSrc;
                    gameOverSound.volume = SOUND_VOLUME.effects;
                    gameOverSound.currentTime = 0;
                    gameOverSound.play().catch(e => {
                        console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ –ø–æ—Ä–∞–∂–µ–Ω–∏—è:', e);
                        
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Audio –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                        const gameOverAudio = new Audio(soundSrc);
                        gameOverAudio.volume = SOUND_VOLUME.effects;
                        gameOverAudio.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ Audio API:', e));
                    });
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            await updateLeaderboard();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        async function saveScore() {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            if (gameAPI.currentUser) {
                await gameAPI.updateUserStats(score, coinCount);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            await updateLeaderboard();
        }
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function restartGame() {
            gameOverScreen.style.display = 'none';
            modalOverlay.style.display = 'none';
            startGame();
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏–º–∏—Ç–∞—Ü–∏—é API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        const mockAPI = {
            users: [],
            leaderboard: [],
            
            async login(username, password) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = this.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
                    const token = 'token_' + Math.random().toString(36).substring(2);
                    return {
                        success: true,
                        message: '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ',
                        token,
                        user: { ...user, password: undefined } // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç—É
                    };
                }
                
                return { success: false, message: '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å' };
            },
            
            async register(username, password) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (this.users.some(u => u.username === username)) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
                }
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const newUser = {
                    id: Date.now(),
                    username,
                    password,
                    coins: 0,
                    highScore: 0,
                    gamesPlayed: 0,
                    totalTimeMinutes: 0,
                    lastLogin: new Date().toISOString(),
                    characters: ['default'],
                    activeCharacter: 'default'
                };
                
                this.users.push(newUser);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const token = 'token_' + Math.random().toString(36).substring(2);
                
                return {
                    success: true,
                    message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞',
                    token,
                    user: { ...newUser, password: undefined } // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç—É
                };
            },
            
            async verifyToken() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
                return { success: true, user: this.users[0] };
            },
            
            async updateStats(userId, score, coinsCollected) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                const user = this.users[userIndex];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (score > user.highScore) {
                    user.highScore = score;
                }
                
                user.coins += coinsCollected;
                user.gamesPlayed += 1;
                user.lastLogin = new Date().toISOString();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                this.updateLeaderboard();
                
                return {
                    success: true,
                    user: { ...user, password: undefined }
                };
            },
            
            async buyCharacter(userId, characterId) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
                const character = CHARACTERS.find(char => char.id === characterId);
                if (!character) {
                    return { success: false, message: '–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                const user = this.users[userIndex];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂
                if (user.characters.includes(characterId)) {
                    return { success: false, message: '–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂' };
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –º–æ–Ω–µ—Ç
                if (user.coins < character.price) {
                    return { success: false, message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç' };
                }
                
                // –ü–æ–∫—É–ø–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                user.coins -= character.price;
                user.characters.push(characterId);
                
                return {
                    success: true,
                    message: '–ü–µ—Ä—Å–æ–Ω–∞–∂ —É—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω',
                    user: { ...user, password: undefined }
                };
            },
            
            async setActiveCharacter(userId, characterId) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                const user = this.users[userIndex];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂
                if (!user.characters.includes(characterId)) {
                    return { success: false, message: '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞' };
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                user.activeCharacter = characterId;
                
                return {
                    success: true,
                    message: '–ü–µ—Ä—Å–æ–Ω–∞–∂ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω',
                    user: { ...user, password: undefined }
                };
            },
            
            async updateTime(userId, minutesSpent) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                this.users[userIndex].totalTimeMinutes += minutesSpent;
                
                return { success: true };
            },
            
            async getLeaderboard() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                this.updateLeaderboard();
                
                return {
                    success: true,
                    leaderboard: this.leaderboard
                };
            },
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            updateLeaderboard() {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–µ–∫–æ—Ä–¥—É (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
                this.leaderboard = this.users
                    .map(user => ({
                        rank: 0, // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ–∑–∂–µ
                        username: user.username,
                        highScore: user.highScore,
                        gamesPlayed: user.gamesPlayed,
                        date: new Date(user.lastLogin).toLocaleDateString()
                    }))
                    .sort((a, b) => b.highScore - a.highScore)
                    .map((user, index) => ({
                        ...user,
                        rank: index + 1
                    }));
            }
        };
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–∫ API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π API
        async function setupAPI() {
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—ã–∑–æ–≤—ã –∫ API –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö –Ω–∞ –º–æ–∫
            const origFetch = window.fetch;
            window.fetch = async function(url, options) {
                if (url.startsWith(API_URL)) {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º endpoint –∏–∑ URL
                    const endpoint = url.replace(API_URL + '/', '');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
                    let body = {};
                    if (options && options.body) {
                        body = JSON.parse(options.body);
                    }
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    let token = null;
                    let userId = null;
                    if (options && options.headers && options.headers.Authorization) {
                        token = options.headers.Authorization.replace('Bearer ', '');
                        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
                        // –î–ª—è –º–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        userId = mockAPI.users.length > 0 ? mockAPI.users[0].id : null;
                    }
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞–∑–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
                    let response;
                    
                    switch (endpoint) {
                        case 'login':
                            response = await mockAPI.login(body.username, body.password);
                            break;
                        case 'register':
                            response = await mockAPI.register(body.username, body.password);
                            break;
                        case 'verify-token':
                            response = await mockAPI.verifyToken(token);
                            break;
                        case 'update-stats':
                            response = await mockAPI.updateStats(userId, body.score, body.coinsCollected);
                            break;
                        case 'buy-character':
                            response = await mockAPI.buyCharacter(userId, body.characterId);
                            break;
                        case 'set-active-character':
                            response = await mockAPI.setActiveCharacter(userId, body.characterId);
                            break;
                        case 'update-time':
                            response = await mockAPI.updateTime(userId, body.minutesSpent);
                            break;
                        case 'leaderboard':
                            response = await mockAPI.getLeaderboard();
                            break;
                        default:
                            return origFetch(url, options);
                    }
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –æ–∂–∏–¥–∞–µ–º–æ–º fetch
                    return {
                        ok: response.success,
                        json: async () => response
                    };
                }
                
                // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π fetch
                return origFetch(url, options);
            };
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç
            if (mockAPI.users.length === 0) {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await mockAPI.register('player1', 'password1');
                await mockAPI.register('player2', 'password2');
                await mockAPI.register('player3', 'password3');
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                mockAPI.users[0].highScore = 1500;
                mockAPI.users[0].coins = 200;
                mockAPI.users[0].gamesPlayed = 10;
                mockAPI.users[0].characters = ['default', 'character1'];
                
                mockAPI.users[1].highScore = 2000;
                mockAPI.users[1].coins = 150;
                mockAPI.users[1].gamesPlayed = 8;
                
                mockAPI.users[2].highScore = 1200;
                mockAPI.users[2].coins = 100;
                mockAPI.users[2].gamesPlayed = 5;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                mockAPI.updateLeaderboard();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async function() {
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            await setupAPI();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            init();
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        gameContainer.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–≤—É–∫–∞ –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∏–ª–∏ –æ–±—ã—á–Ω–æ–≥–æ –ø—É—Ç–∏
        function getRandomSound(soundSource) {
            if (!soundSource) return null;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –º–∞—Å—Å–∏–≤, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∑–≤—É–∫
            if (Array.isArray(soundSource) && soundSource.length > 0) {
                const randomIndex = Math.floor(Math.random() * soundSource.length);
                return soundSource[randomIndex];
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ—ë
            return soundSource;
        }

        function setCharacter(characterId) {
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
            const character = CHARACTERS.find(char => char.id === characterId);
            if (!character) return;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏ –∏ –∫–ª–∞—Å—Å—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            player.style.width = character.width + 'px';
            player.style.height = character.height + 'px';
            player.style.backgroundImage = `url(${character.image})`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ª–∏—Ç—Ä—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            document.documentElement.style.setProperty('--character-color', character.color || '#4285f4');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            activeCharacter = character;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            if (character.sounds) {
                jumpSound.src = character.sounds.jump || SOUNDS.jump;
                coinSound.src = character.sounds.coin || SOUNDS.coin;
                gameOverSound.src = getRandomSound(character.sounds.gameOver) || SOUNDS.gameOver;
                gameStartSound.src = getRandomSound(character.sounds.gameStart) || SOUNDS.gameStart;
            }
            
            if (gameAPI.currentUser) {
                gameAPI.saveCharacter(gameAPI.currentUser.id, characterId)
                    .catch(error => console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error));
            } else {
                localStorage.setItem('selectedCharacter', characterId);
            }
        }

        // –í—ã–±–∏—Ä–∞–µ–º —Å–æ—Å—Ç–∞–≤ –º–∞–≥–∞–∑–∏–Ω–∞
        function populateShop() {
            const shopContainer = document.getElementById('shop-characters');
            shopContainer.innerHTML = '';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö/–∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            const unlockedCharacters = getUnlockedCharacters();
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
            CHARACTERS.forEach(character => {
                const isUnlocked = character.unlocked || unlockedCharacters.includes(character.id);
                const isSelected = activeCharacter && activeCharacter.id === character.id;
                
                const characterCard = document.createElement('div');
                characterCard.className = `shop-item ${isUnlocked ? 'unlocked' : ''} ${isSelected ? 'current' : ''}`;
                characterCard.style.backgroundColor = isSelected ? character.color + '33' : '';
                characterCard.style.borderColor = character.color;
                
                // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                characterCard.innerHTML = `
                    <div class="character-image" style="background-image: url(${character.image})"></div>
                    <div class="character-name">${character.name}</div>
                    <div class="character-stats">
                        <div class="stat">–í—ã—Å–æ—Ç–∞ –ø—Ä—ã–∂–∫–∞: <span class="value">${Math.floor(character.jumpHeight / 2)}</span></div>
                        <div class="stat">–°–∫–æ—Ä–æ—Å—Ç—å: <span class="value">${Math.floor((character.width / 80) * 10)}</span></div>
                    </div>
                    <button class="shop-button ${!isUnlocked ? 'buy' : 'select'}" 
                        data-character="${character.id}" 
                        data-unlocked="${isUnlocked}" 
                        data-price="${character.price}"
                        style="background-color: ${isUnlocked ? 'var(--shop-button-select)' : 'var(--shop-button-buy)'}">
                        ${!isUnlocked ? `–ö—É–ø–∏—Ç—å –∑–∞ ${character.price} –º–æ–Ω–µ—Ç` : (isSelected ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å')}
                    </button>
                `;
                
                shopContainer.appendChild(characterCard);
                
                // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏/–≤—ã–±–æ—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                const button = characterCard.querySelector('.shop-button');
                button.addEventListener('click', function() {
                    const characterId = this.dataset.character;
                    const unlocked = this.dataset.unlocked === 'true';
                    const price = parseInt(this.dataset.price);
                    
                    if (unlocked) {
                        // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –≤—ã–±–∏—Ä–∞–µ–º –µ–≥–æ
                        const character = CHARACTERS.find(c => c.id === characterId);
                        if (character) {
                            setCharacter(characterId);
                            updateShopButtons();
                        }
                    } else {
                        // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø—ã—Ç–∞–µ–º—Å—è –∫—É–ø–∏—Ç—å
                        buyCharacter(characterId, price);
                    }
                });
            });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        function updateShopButtons() {
            const buttons = document.querySelectorAll('.shop-button');
            buttons.forEach(button => {
                const characterId = button.dataset.character;
                const unlocked = button.dataset.unlocked === 'true';
                const isSelected = activeCharacter && activeCharacter.id === characterId;
                
                if (unlocked) {
                    button.textContent = isSelected ? '–í—ã–±—Ä–∞–Ω–æ' : '–í—ã–±—Ä–∞—Ç—å';
                    button.style.backgroundColor = 'var(--shop-button-select)';
                    button.closest('.shop-item').classList.toggle('current', isSelected);
                    button.closest('.shop-item').style.backgroundColor = isSelected ? 
                        activeCharacter.color + '33' : '';
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function initializeCharacter() {
            // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            player = document.createElement('div');
            player.id = 'player';
            gameContainer.appendChild(player);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            let selectedCharacterId = 'default';
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –±–µ—Ä–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            if (gameAPI.currentUser && gameAPI.currentUser.activeCharacter) {
                selectedCharacterId = gameAPI.currentUser.activeCharacter;
            } else {
                // –ò–Ω–∞—á–µ –±–µ—Ä–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                const localSelectedCharacter = localStorage.getItem('selectedCharacter');
                if (localSelectedCharacter) {
                    selectedCharacterId = localSelectedCharacter;
                }
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –µ–≥–æ —Å—Ç–∏–ª–∏
            const character = CHARACTERS.find(char => char.id === selectedCharacterId);
            if (character) {
                activeCharacter = character;
                player.style.width = character.width + 'px';
                player.style.height = character.height + 'px';
                player.style.backgroundImage = `url(${character.image})`;
                
                document.documentElement.style.setProperty('--character-color', character.color || '#4285f4');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (character.sounds) {
                    jumpSound.src = character.sounds.jump || SOUNDS.jump;
                    coinSound.src = character.sounds.coin || SOUNDS.coin;
                    gameOverSound.src = getRandomSound(character.sounds.gameOver) || SOUNDS.gameOver;
                    gameStartSound.src = getRandomSound(character.sounds.gameStart) || SOUNDS.gameStart;
                }
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –≤—Å–µ—Ö –∑–≤—É–∫–æ–≤ –≤ –∏–≥—Ä–µ
        function setupAudioVolumes() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞—É–¥–∏–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            jumpSound.volume = SOUND_VOLUME.effects;
            coinSound.volume = SOUND_VOLUME.effects;
            gameOverSound.volume = SOUND_VOLUME.effects;
            gameStartSound.volume = SOUND_VOLUME.effects;
            purchaseSound.volume = SOUND_VOLUME.effects;
            backgroundMusic.volume = SOUND_VOLUME.background;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function optimizeForMobile() {
            const isMobile = isMobileDevice();
            
            if (isMobile) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É –ø—Ä—ã–∂–∫–∞
                mobileJumpButton.style.display = 'block';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∂–µ—Å—Ç–æ–≤
                document.addEventListener('touchmove', function(e) {
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
                    if (isGameStarted && !isGameOver) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                obstacleInterval = 2000; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                coinInterval = 1500; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –º–æ–Ω–µ—Ç–∞–º–∏
                
                // –£–º–µ–Ω—å—à–∞–µ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
                document.querySelectorAll('.obstacle, .coin').forEach(el => {
                    el.style.willChange = 'transform';
                });
            } else {
                // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É –ø—Ä—ã–∂–∫–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
                mobileJumpButton.style.display = 'none';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –Ω–∞—á–∞–ª—å–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
        function initialize() {
            initializeCharacter();
            initializeShop();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫–∏
            preloadSounds();
            setupAudioVolumes();
            
            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            optimizeForMobile();
            
            // API –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            gameAPI = new GameAPI();
            updateAuthUI();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ localStorage
            const savedSound = localStorage.getItem('sound');
            if (savedSound === 'off') {
                soundToggle.checked = false;
                soundEnabled = false;
            }
            
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                darkThemeToggle.checked = true;
                document.body.setAttribute('data-theme', 'dark');
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É, –µ—Å–ª–∏ –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω
            if (soundEnabled) {
                backgroundMusic.volume = SOUND_VOLUME.background;
                backgroundMusic.loop = true;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
            showWelcome();
        }
        
        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫
        function preloadSounds() {
            console.log("–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–æ–≤...");
            
            // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            for (const soundType in SOUNDS) {
                if (Array.isArray(SOUNDS[soundType])) {
                    SOUNDS[soundType].forEach(soundUrl => {
                        const audio = new Audio();
                        audio.src = soundUrl;
                        audio.preload = 'auto';
                        audio.load();
                    });
                } else {
                    const audio = new Audio();
                    audio.src = SOUNDS[soundType];
                    audio.preload = 'auto';
                    audio.load();
                }
            }
            
            // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            CHARACTERS.forEach(character => {
                if (character.sounds) {
                    for (const soundType in character.sounds) {
                        if (Array.isArray(character.sounds[soundType])) {
                            character.sounds[soundType].forEach(soundUrl => {
                                const audio = new Audio();
                                audio.src = soundUrl;
                                audio.preload = 'auto';
                                audio.load();
                            });
                        } else if (character.sounds[soundType]) {
                            const audio = new Audio();
                            audio.src = character.sounds[soundType];
                            audio.preload = 'auto';
                            audio.load();
                        }
                    }
                }
            });
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
            