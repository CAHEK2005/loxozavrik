<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ—Ö–æZ–∞V—Ä–∏–∫</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        :root {
            --background-color: #1a472a;
            --text-color: #d2b48c;
            --game-background: #0c2518;
            --border-color: #704214;
            --button-color: #d97500;
            --button-text: #fff8e1;
            --table-header: #2c3e2c;
            --table-border: #704214;
            --record-highlight: #203d28;
            --modal-bg: rgba(0, 0, 0, 0.8);
            --card-bg: #193026;
            --shop-item-hover: #2a4a33;
            --shop-button-disabled: #5e5e5e;
            --shop-button-buy: #af6300;
            --shop-button-select: #c27c0a;
            --current-character: #2c5a3a;
            --shop-button: #b38410;
            --error-color: #ff5252;
            --success-color: #66bb6a;
            --profile-bg: #2c5a3a;
            --logout-button: #aa2e25;
            --header-bg: #0f2313;
            --header-text: #e6cd94;
        }
        
        [data-theme="dark"] {
            --background-color: #0a1e12;
            --text-color: #c4a775;
            --game-background: #06160d;
            --border-color: #5b370f;
            --button-color: #b36504;
            --button-text: #f5e9d1;
            --table-header: #1b2b1b;
            --table-border: #422608;
            --record-highlight: #122117;
            --modal-bg: rgba(0, 0, 0, 0.9);
            --card-bg: #0f221c;
            --shop-item-hover: #1a3522;
            --shop-button-disabled: #3d3d3d;
            --shop-button-buy: #8a4f00;
            --shop-button-select: #965e05;
            --current-character: #1b3a25;
            --shop-button: #7d5c08;
            --error-color: #cf4545;
            --success-color: #4d8d50;
            --profile-bg: #1b3a25;
            --logout-button: #7c2018;
            --header-bg: #08150b;
            --header-text: #d4be85;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }
        
        html, body {
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            background-color: var(--background-color);
            background-image: url('/images/background-pattern.png');
            background-attachment: fixed;
            color: var(--text-color);
            padding: 0;
            margin: 0;
            touch-action: manipulation;
        }
        
        .main-container {
            padding: 0 15px 20px 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 400;
        }
        
        #settings {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .toggle {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--button-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        #game-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            height: 280px;
            margin: 0 auto 20px auto;
            background-color: var(--game-background);
            background-image: url('/images/game-background.png');
            background-repeat: repeat-x;
            background-position: bottom;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        #player {
            position: absolute;
            bottom: 0;
            left: 50px;
            z-index: 2;
        }
        
        .obstacle {
            position: absolute;
            bottom: 0;
        }
        
        .coin {
            position: absolute;
            z-index: 1;
        }
        
        #ground {
            position: absolute;
            width: 100%;
            height: 1px;
            bottom: 0;
            background-color: var(--border-color);
        }
        
        #score-container {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            font-weight: 500;
            text-align: right;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .game-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--game-background);
            padding: 20px;
            border-radius: 10px;
            display: none;
            z-index: 15;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            min-width: 280px;
            max-width: 90%;
        }
        
        .game-modal h2 {
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        input[type="text"], input[type="password"] {
            padding: 8px 12px;
            margin: 10px 0;
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        button {
            padding: 8px 16px;
            margin-top: 15px;
            background-color: var(--button-color);
            color: var(--button-text);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: opacity 0.2s;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        #stats-container {
            width: 100%;
            max-width: 1000px;
            margin: 30px auto;
            text-align: left;
            background-color: var(--game-background);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        #stats-container h2 {
            margin-bottom: 20px;
            font-weight: 700;
            text-align: center;
            color: var(--button-color);
            font-size: 24px;
            position: relative;
            padding-bottom: 10px;
        }
        
        #stats-container h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background-color: var(--button-color);
            border-radius: 3px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
        }
        
        th {
            background-color: var(--table-header);
            font-weight: 600;
            color: var(--button-color);
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
        }
        
        td {
            border-bottom: 1px solid var(--table-border);
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:nth-child(even) {
            background-color: var(--record-highlight);
        }
        
        tr:hover {
            background-color: var(--shop-item-hover);
        }
        
        .jumping {
            animation: jump 0.5s ease-out;
        }
        
        @keyframes jump {
            0% {
                bottom: 0;
            }
            50% {
                bottom: 150px;
            }
            100% {
                bottom: 0;
            }
        }
        
        #controls {
            margin: 15px auto;
            padding: 10px;
            background-color: var(--game-background);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: inline-block;
            font-size: 14px;
        }
        
        .game-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .game-button {
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            background-color: var(--button-color);
            color: var(--button-text);
            font-weight: 600;
            cursor: pointer;
            margin: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .game-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        .game-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .game-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
            pointer-events: none;
        }
        
        #music-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 3;
        }
        
        #music-controls button {
            background-color: transparent;
            border: none;
            color: var(--text-color);
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            opacity: 0.7;
            margin: 0;
        }
        
        #music-controls button:hover {
            opacity: 1;
        }
        
        #shop-button, .shop-button {
            background-color: var(--shop-button);
        }
        
        #shop-modal {
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--modal-bg);
            z-index: 10;
            display: none;
        }
        
        .shop-balance {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--background-color);
            border-radius: 8px;
        }
        
        .coin-balance {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }
        
        .coin-icon {
            width: 20px;
            height: 20px;
            background-color: gold;
            border-radius: 50%;
            border: 1px solid #b8860b;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .shop-item {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--card-bg);
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .shop-item:hover {
            background-color: var(--shop-item-hover);
            transform: translateY(-3px);
        }
        
        .shop-item.selected {
            border: 2px solid var(--button-color);
            background-color: var(--current-character);
        }
        
        .character-preview {
            width: 60px;
            height: 60px;
            margin-bottom: 10px;
            object-fit: contain;
        }
        
        .character-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .character-price {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .character-actions {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .buy-button, .select-button {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            width: 100%;
            margin-top: 5px;
        }
        
        .buy-button {
            background-color: var(--shop-button-buy);
        }
        
        .buy-button:disabled {
            background-color: var(--shop-button-disabled);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .select-button {
            background-color: var(--shop-button-select);
        }
        
        .close-button {
            position: absolute;
            right: 10px;
            top: 10px;
            background: transparent;
            border: none;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            width: 24px;
            height: 24px;
        }
        
        .mobile-jump-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 50px;
            font-size: 18px;
            background-color: var(--button-color);
            color: var(--button-text);
            border: none;
            border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 5;
            display: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .mobile-jump-button:active {
            transform: translateX(-50%) scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—Ä—ã–∂–∫–∞ */
        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
            100% { transform: translateX(-50%) scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        .auth-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        .auth-link {
            color: var(--button-color);
            cursor: pointer;
            text-decoration: underline;
        }
        
        .form-row {
            margin-bottom: 15px;
        }
        
        .form-row label {
            display: block;
            margin-bottom: 5px;
            text-align: left;
            font-weight: 500;
        }
        
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .error {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        .success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }
        
        .game-over-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 15px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background-color: var(--profile-bg);
            border-radius: 20px;
            margin-left: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            cursor: pointer;
        }
        
        /* –£–±–∏—Ä–∞–µ–º —Ö–æ–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –Ω–æ–≤—ã–º –ø–æ–¥—Ö–æ–¥–æ–º */
        /* .user-profile:hover .profile-menu {
            display: block;
            opacity: 1;
            transform: translateY(0);
        } */
        
        .profile-menu {
            display: none;
            position: fixed;
            top: auto;
            right: auto;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 5px 0;
            z-index: 9999;
            min-width: 150px;
            margin-top: 5px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s, transform 0.3s;
            color: var(--text-color);
        }
        
        .profile-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            text-align: left;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        
        .profile-menu-item:hover {
            background-color: var(--shop-item-hover);
        }
        
        .profile-menu-item.logout {
            color: var(--logout-button);
            border-top: 1px solid var(--border-color);
        }
        
        .profile-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--button-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--button-text);
            font-weight: bold;
        }
        
        .profile-details {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-size: 14px;
        }
        
        .profile-name {
            font-weight: 500;
        }
        
        .profile-stats {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .auth-container {
            display: flex;
            align-items: center;
            margin-left: auto;
            gap: 15px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
        }
        
        .site-header {
            background-color: var(--header-bg);
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 0 0 15px 15px;
            position: relative;
            overflow: hidden;
        }
        
        .site-header-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            z-index: 0;
        }
        
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-image {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .game-title {
            color: var(--header-text);
            font-size: 26px;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .profile-modal {
            max-width: 500px;
        }
        
        .profile-heading {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .profile-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            background-color: var(--background-color);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .profile-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .logout-button {
            background-color: var(--logout-button);
        }
        
        /* Media Queries –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            h1 {
                font-size: 20px;
                margin-bottom: 10px;
            }
            
            #game-container {
                height: 240px; /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
            
            .toggle-container {
                font-size: 12px;
            }
            
            #settings {
                gap: 10px;
            }
            
            .mobile-jump-button {
                display: block;
            }
            
            .shop-items {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .character-preview {
                width: 50px;
                height: 50px;
            }
            
            .character-name, .character-price {
                font-size: 12px;
            }
            
            .buy-button, .select-button {
                padding: 4px 8px;
                font-size: 11px;
            }
            
            .game-over-buttons {
                flex-direction: column;
            }
            
            .header-container {
                flex-direction: column;
                align-items: center;
            }
            
            .auth-container {
                margin: 0;
            }
            
            .profile-stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 400px) {
            #game-container {
                height: 200px; /* –ï—â–µ –º–µ–Ω—å—à–µ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
            }
            
            .shop-items {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .shop-item {
                padding: 5px;
            }
            
            .character-preview {
                width: 40px;
                height: 40px;
            }
            
            .mobile-jump-button {
                padding: 12px 40px;
                font-size: 16px;
            }
        }

        #loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <img src="/images/header-bg.png" alt="–§–æ–Ω —à–∞–ø–∫–∏" class="site-header-bg" id="header-bg">
        <div class="header-container">
            <div class="game-logo">
                <img src="/images/logo.png" alt="–õ–æ–≥–æ" class="logo-image" id="logo-image">
                <h1 class="game-title">–õ–æ—Ö–æZ–∞V—Ä–∏–∫</h1>
            </div>
            
            <div id="auth-container" class="auth-container">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <button id="login-button" class="game-button">–í–æ–π—Ç–∏</button>
                <button id="register-button" class="game-button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
        </div>
    </header>
    
    <div class="main-container">
    
    <div id="settings">
        <div class="toggle-container">
            <span>–°–≤–µ—Ç–ª–∞—è</span>
            <label class="toggle">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
            <span>–¢—ë–º–Ω–∞—è</span>
        </div>
        
        <div class="toggle-container">
            <span>–ó–≤—É–∫ –≤—ã–∫–ª</span>
            <label class="toggle">
                <input type="checkbox" id="sound-toggle" checked>
                <span class="slider"></span>
            </label>
            <span>–ó–≤—É–∫ –≤–∫–ª</span>
        </div>
    </div>
    
    <div id="game-container">
        <img id="player" src="/api/placeholder/48/52" alt="Player">
        
        <div id="ground"></div>
        
        <div id="score-container">
            <div>–°—á—ë—Ç: <span id="score">0</span></div>
            <div>–ú–æ–Ω–µ—Ç: <span id="coins">0</span></div>
        </div>
        
        <div id="music-controls">
            <button id="music-toggle">üîä</button>
        </div>
    </div>
    
    <div class="game-buttons">
        <button id="start-button" class="game-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="shop-button" class="game-button">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button id="profile-button" class="game-button" style="display: none;">–ü—Ä–æ—Ñ–∏–ª—å</button>
    </div>
    
    <div id="controls">
        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ü—Ä—ã–∂–æ–∫"</p>
    </div>
    
    <button id="mobile-jump" class="mobile-jump-button">–ü—Ä—ã–∂–æ–∫</button>
    
    <div id="stats-container">
        <h2>–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</h2>
        <table id="leaderboard">
            <thead>
                <tr>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–ò–º—è</th>
                    <th>–°—á—ë—Ç</th>
                    <th>–ò–≥—Ä</th>
                    <th>–î–∞—Ç–∞</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                <tr>
                    <td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="modal-overlay" class="modal-overlay"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div id="login-modal" class="game-modal">
        <button class="close-button" id="login-close">&times;</button>
        <h2>–í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h2>
        <div id="login-message" class="message" style="display: none;"></div>
        
        <div class="form-row">
            <label for="login-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <input type="text" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        </div>
        
        <div class="form-row">
            <label for="login-password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        
        <button id="login-submit" class="game-button">–í–æ–π—Ç–∏</button>
        
        <div class="auth-links">
            <span class="auth-link" id="to-register">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="register-modal" class="game-modal">
        <button class="close-button" id="register-close">&times;</button>
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <div id="register-message" class="message" style="display: none;"></div>
        
        <div class="form-row">
            <label for="register-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <input type="text" id="register-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" maxlength="20">
        </div>
        
        <div class="form-row">
            <label for="register-password">–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" id="register-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        
        <div class="form-row">
            <label for="register-confirm">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è:</label>
            <input type="password" id="register-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
        </div>
        
        <button id="register-submit" class="game-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        
        <div class="auth-links">
            <span class="auth-link" id="to-login">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</span>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profile-modal" class="game-modal profile-modal">
        <button class="close-button" id="profile-close">&times;</button>
        <h2 class="profile-heading">–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞ <span id="profile-username">Username</span></h2>
        
        <div class="profile-stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="profile-coins">0</div>
                <div class="stat-label">–ú–æ–Ω–µ—Ç</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="profile-highscore">0</div>
                <div class="stat-label">–†–µ–∫–æ—Ä–¥</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="profile-games">0</div>
                <div class="stat-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="profile-time">0</div>
                <div class="stat-label">–í—Ä–µ–º—è –Ω–∞ —Å–∞–π—Ç–µ (–º–∏–Ω)</div>
            </div>
        </div>
        
        <div class="profile-actions">
            <button id="logout-button" class="game-button logout-button">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã (—Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏) -->
    <div id="game-over" class="game-modal">
        <button class="close-button" id="game-over-close">&times;</button>
        <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
        <p>–í–∞—à —Å—á—ë—Ç: <span id="final-score">0</span></p>
        <p>–°–æ–±—Ä–∞–Ω–æ –º–æ–Ω–µ—Ç: <span id="final-coins">0</span></p>
        <div class="game-over-buttons">
            <button id="restart-btn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            <button id="shop-btn-modal" class="shop-button">–ú–∞–≥–∞–∑–∏–Ω</button>
        </div>
    </div>
    
    <div id="shop-modal" class="game-modal">
        <button class="close-button" id="shop-close">&times;</button>
        <h2>–ú–∞–≥–∞–∑–∏–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π</h2>
        
        <div class="shop-balance">
            <div class="coin-balance">
                <div class="coin-icon"></div>
                <span id="shop-coins">0</span> –º–æ–Ω–µ—Ç
            </div>
            <div id="char-owned">–ü–µ—Ä—Å–æ–Ω–∞–∂–µ–π: <span id="owned-count">1</span> –∏–∑ <span id="total-count">5</span></div>
        </div>
        
        <div class="shop-items" id="character-list">
            <!-- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –º—É–∑—ã–∫–∏ –∏ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ -->
    <audio id="background-music" loop>
        <source src="/sounds/defaults/background.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="jump-sound">
        <source src="/sounds/defaults/jump.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="coin-sound">
        <source src="/sounds/defaults/coin.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="game-over-sound">
        <source src="/sounds/defaults/game-over.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="purchase-sound">
        <source src="/sounds/defaults/purchase.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ============= –ù–ê–°–¢–†–û–ô–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ò –ó–í–£–ö–û–í =============
        // –°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å –∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∑–≤—É–∫–∞–º–∏
        const CHARACTERS = [
            {
                id: 'default',
                name: '–õ–æ—Ö–æ–∑–∞–≤—Ä–∏–∫',
                image: '/images/players/default/player_default.png',
                width: 60,
                height: 65,
                hitboxWidth: 42,
                hitboxHeight: 50,
                jumpHeight: 150,
                price: 0,
                unlocked: true,
                sounds: {
                    jump: '/sounds/players/default/jump.mp3',
                    coin: '/sounds/players/default/coin.mp3',
                    gameOver: '/sounds/players/default/game_over.mp3'
                },
                color: '#4285f4'
            },
            {
                id: 'character1',
                name: '–°–∏—Å—å–∫–æ—Å–ª–∞–≤',
                image: '/images/players/player_svyat.png',
                width: 62,
                height: 68,
                hitboxWidth: 44,
                hitboxHeight: 52,
                jumpHeight: 165,
                price: 10,
                sounds: {
                    jump: '/sounds/svyat/jump.mp3',
                    coin: '/sounds/svyat/coin.mp3',
                    gameOver: '/sounds/svyat/game_over.mp3'
                },
                color: '#d81b60'
            },
            {
                id: 'character2',
                name: '–°–∫—É—Ñ–ª–∏–∫',
                image: '/images/players/player_skuflik.png',
                width: 58,
                height: 64,
                hitboxWidth: 40,
                hitboxHeight: 48,
                jumpHeight: 140,
                price: 25,
                sounds: {
                    jump: '/sounds/skuflik/jump.mp3',
                    coin: '/sounds/skuflik/coin.mp3',
                    gameOver: '/sounds/skuflik/game_over.mp3'
                },
                color: '#43a047'
            },
            {
                id: 'character3',
                name: '–ó—É–∞–∞–π—Ü—ç–Ω–∏–¥',
                image: '/images/players/player_leonid.png',
                width: 64,
                height: 70,
                hitboxWidth: 46,
                hitboxHeight: 54,
                jumpHeight: 175,
                price: 50,
                sounds: {
                    jump: '/sounds/leonid/jump.mp3',
                    coin: '/sounds/leonid/coin.mp3',
                    gameOver: '/sounds/leonid/game_over.mp3'
                },
                color: '#fb8c00'
            },
            {
                id: 'character4',
                name: '–ü–∏–¥–∏–¥–∏',
                image: '/images/players/player_pididi.png',
                width: 62,
                height: 72,
                hitboxWidth: 42,
                hitboxHeight: 58,
                jumpHeight: 160,
                price: 100,
                sounds: {
                    jump: '/sounds/pididi/jump.mp3',
                    coin: '/sounds/pididi/coin.mp3',
                    gameOver: '/sounds/pididi/game_over.mp3'
                },
                color: '#00897b'
            },
            {
                id: 'character5',
                name: '–°–∫–∏–±–∏–¥–∏ –¢—É–∞–ª–µ—Ç',
                image: '/images/players/player_skibidi.png',
                width: 66,
                height: 70,
                hitboxWidth: 48,
                hitboxHeight: 56,
                jumpHeight: 180,
                price: 100,
                sounds: {
                    jump: '/sounds/skibidi/jump.mp3',
                    coin: '/sounds/skibidi/coin.mp3',
                    gameOver: '/sounds/skibidi/game_over.mp3'
                },
                color: '#7b1fa2'
            }
        ];

        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–≥—Ä—ã (–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –∏ –º–æ–Ω–µ—Ç—ã)
        const OBSTACLES = [
            {
                id: 'penguin',
                image: '/images/obstacles/penguin.png',
                width: 35,
                height: 70,
                hitboxWidth: 20, // –£–º–µ–Ω—å—à–∏–ª —Å 25
                hitboxHeight: 60, // –£–º–µ–Ω—å—à–∏–ª —Å 65
                speed: 1.0 // –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ (1.0 = —Å—Ç–∞–Ω–¥–∞—Ä—Ç)
            },
            {
                id: 'rock',
                image: '/images/obstacles/rock.png',
                width: 40,
                height: 35,
                hitboxWidth: 30, // –£–º–µ–Ω—å—à–∏–ª —Å 38
                hitboxHeight: 28, // –£–º–µ–Ω—å—à–∏–ª —Å 32
                speed: 1.2 // –î–≤–∏–∂–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
            },
            {
                id: 'bird',
                image: '/images/obstacles/bird.png',
                width: 45,
                height: 35,
                hitboxWidth: 35, // –£–º–µ–Ω—å—à–∏–ª —Å 40
                hitboxHeight: 25, // –£–º–µ–Ω—å—à–∏–ª —Å 30
                speed: 1.3, // –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π
                isFlying: true, // –õ–µ—Ç–∞—é—â–µ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ
                minHeight: 50, // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –æ—Ç –∑–µ–º–ª–∏
                maxHeight: 120 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –æ—Ç –∑–µ–º–ª–∏
            },
            {
                id: 'spike',
                image: '/images/obstacles/spike.png',
                width: 30,
                height: 25,
                hitboxWidth: 22, // –£–º–µ–Ω—å—à–∏–ª —Å 27
                hitboxHeight: 18, // –£–º–µ–Ω—å—à–∏–ª —Å 22
                speed: 0.9, // –ú–µ–¥–ª–µ–Ω–Ω–µ–µ
                count: 3, // –ú–æ–∂–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≥—Ä—É–ø–ø–∞–º–∏
                spacing: 40 // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —à–∏–ø–∞–º–∏ –≤ –≥—Ä—É–ø–ø–µ
            },
            {
                id: 'log',
                image: '/images/obstacles/log.png',
                width: 60,
                height: 40,
                hitboxWidth: 50, // –£–º–µ–Ω—å—à–∏–ª —Å 58
                hitboxHeight: 30, // –£–º–µ–Ω—å—à–∏–ª —Å 35
                speed: 0.8 // –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω–æ —à–∏—Ä–æ–∫–∏–π
            }
        ];

        // –†–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –º–æ–Ω–µ—Ç —Å —Ä–∞–∑–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é
        const COINS = [
            {
                id: 'bronze',
                image: '/images/coins/coin_bronze.png',
                width: 25,
                height: 25,
                hitboxWidth: 20,
                hitboxHeight: 20,
                value: 1 // –û–±—ã—á–Ω–∞—è –º–æ–Ω–µ—Ç–∞
            },
            {
                id: 'silver',
                image: '/images/coins/coin_silver.png',
                width: 28,
                height: 28,
                hitboxWidth: 22,
                hitboxHeight: 22,
                value: 3, // –°–µ—Ä–µ–±—Ä—è–Ω–∞—è –º–æ–Ω–µ—Ç–∞ = 3 –æ—á–∫–∞
                rarity: 0.3 // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è (30%)
            },
            {
                id: 'gold',
                image: '/images/coins/coin_gold.png',
                width: 30,
                height: 30,
                hitboxWidth: 24,
                hitboxHeight: 24,
                value: 5, // –ó–æ–ª–æ—Ç–∞—è –º–æ–Ω–µ—Ç–∞ = 5 –æ—á–∫–æ–≤
                rarity: 0.1 // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è (10%)
            }
        ];
        
        // –ë–æ–Ω—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
        const BONUSES = [
            {
                id: 'shield',
                image: '/images/bonuses/bonus_shield.png',
                width: 35,
                height: 35,
                hitboxWidth: 30,
                hitboxHeight: 30,
                effect: 'shield', // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≥–æ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                duration: 10000, // 10 —Å–µ–∫—É–Ω–¥
                rarity: 0.05 // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è (5%)
            },
            {
                id: 'slow',
                image: '/images/bonuses/bonus_slow.png',
                width: 35,
                height: 35,
                hitboxWidth: 30,
                hitboxHeight: 30,
                effect: 'slow', // –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
                duration: 5000, // 5 —Å–µ–∫—É–Ω–¥
                rarity: 0.08 // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è (8%)
            },
            {
                id: 'magnet',
                image: '/images/bonuses/bonus_magnet.png',
                width: 35,
                height: 35,
                hitboxWidth: 30,
                hitboxHeight: 30,
                effect: 'magnet', // –ü—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –º–æ–Ω–µ—Ç—ã
                duration: 8000, // 8 —Å–µ–∫—É–Ω–¥
                rarity: 0.07 // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏—è (7%)
            }
        ];
        
        // –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∏–≥—Ä—ã
        const SOUNDS = {
            background: '/sounds/defaults/background.mp3',
            jump: '/sounds/defaults/jump.mp3', // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–≤—É–∫ –ø—Ä—ã–∂–∫–∞ (–µ—Å–ª–∏ —É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ—Ç —Å–≤–æ–µ–≥–æ)
            coin: '/sounds/defaults/coin.mp3', // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–≤—É–∫ –º–æ–Ω–µ—Ç—ã
            gameOver: '/sounds/defaults/game-over.mp3', // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–≤—É–∫ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
            purchase: '/sounds/defaults/purchase.mp3',
            bonus: '/sounds/defaults/bonus.mp3', // –ó–≤—É–∫ —Å–±–æ—Ä–∞ –±–æ–Ω—É—Å–∞
            shieldEnd: '/sounds/defaults/shield_end.mp3', // –ó–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
            levelUp: '/sounds/defaults/level_up.mp3' // –ó–≤—É–∫ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
        };
        
        // API URL –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        const API_URL = 'http://192.168.0.240/api';
        
        // ============= –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –ò –ë–ê–ó–´ –î–ê–ù–ù–´–• =============
        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
        class GameAPI {
            constructor() {
                this.currentUser = null;
                this.sessionStartTime = null;
                this.timeInterval = null;
                this.apiToken = localStorage.getItem('lohozavrikToken') || null;
                this.apiUrl = '/api'; // –ü—É—Ç—å –∫ API —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ Nginx
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                if (this.apiToken) {
                    this.verifyToken();
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
            async verifyToken() {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/verify-token`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        this.currentUser = data.user;
                        this.startTimeTracking();
                        return true;
                    } else {
                        // –¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, —É–¥–∞–ª—è–µ–º –µ–≥–æ
                        this.logout();
                        return false;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:', error);
                    hideLoading();
                    return false;
                }
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            async register(username, password) {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.token && data.user) {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                        this.apiToken = data.token;
                        this.currentUser = data.user;
                        localStorage.setItem('lohozavrikToken', this.apiToken);
                        
                        // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Ä–µ–º—è
                        this.startTimeTracking();
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            async login(username, password) {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.token && data.user) {
                        this.apiToken = data.token;
                        this.currentUser = data.user;
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                        localStorage.setItem('lohozavrikToken', this.apiToken);
                        
                        // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Ä–µ–º—è
                        this.startTimeTracking();
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            // –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            logout() {
                if (this.currentUser) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
                    this.saveTimeSpent();
                    
                    // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–æ–∫–µ–Ω
                    this.currentUser = null;
                    this.apiToken = null;
                    localStorage.removeItem('lohozavrikToken');
                    clearInterval(this.timeInterval);
                    
                    return { success: true, message: "–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã" };
                }
                
                return { success: false, message: "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" };
            }
            
            // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Ä–µ–º—è
            startTimeTracking() {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏
                this.sessionStartTime = new Date();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
                clearInterval(this.timeInterval);
                this.timeInterval = setInterval(() => {
                    this.saveTimeSpent();
                }, 60000); // –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–µ –Ω–∞ —Å–∞–π—Ç–µ
            async saveTimeSpent() {
                if (this.currentUser && this.sessionStartTime && this.apiToken) {
                    const now = new Date();
                    const minutesSpent = Math.floor((now - this.sessionStartTime) / 60000);
                    
                    if (minutesSpent > 0) {
                        try {
                            await fetch(`${this.apiUrl}/update-time`, {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${this.apiToken}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ minutesSpent })
                            });
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                            if (this.currentUser.totalTimeMinutes) {
                                this.currentUser.totalTimeMinutes += minutesSpent;
                            }
                            
                            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏
                            this.sessionStartTime = now;
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', error);
                        }
                    }
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –∏–≥—Ä—ã
            async updateUserStats(score, coinsCollected) {
                if (!this.currentUser || !this.apiToken) {
                    return { success: false, message: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω" };
                }
                
                try {
                    const duration = Math.floor((Date.now() - gameStartTime) / 1000); // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                    
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/update-stats`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ score, coinsCollected, duration })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        this.currentUser = data.user;
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            // –ü–æ–∫—É–ø–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            async buyCharacter(characterId) {
                if (!this.currentUser || !this.apiToken) {
                    return { success: false, message: "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" };
                }
                
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/buy-character`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ characterId })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        this.currentUser = data.user;
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            async setActiveCharacter(characterId) {
                if (!this.currentUser || !this.apiToken) {
                    return { success: false, message: "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" };
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂
                if (!this.currentUser.characters.includes(characterId)) {
                    return { success: false, message: "–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" };
                }
                
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/set-active-character`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ characterId })
                    });
                    
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.user) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        this.currentUser = data.user;
                    }
                    
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
                    hideLoading();
                    return { success: false, message: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º' };
                }
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            async getGlobalLeaderboard() {
                try {
                    showLoading();
                    const response = await fetch(`${this.apiUrl}/leaderboard`);
                    const data = await response.json();
                    hideLoading();
                    
                    if (data.success && data.leaderboard) {
                        return data.leaderboard;
                    }
                    
                    return [];
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤:', error);
                    hideLoading();
                    return [];
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º API
        const gameAPI = new GameAPI();
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading() {
            document.getElementById('loading-spinner').style.display = 'flex';
        }
        
        // –°–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        function hideLoading() {
            document.getElementById('loading-spinner').style.display = 'none';
        }
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const scoreDisplay = document.getElementById('score');
        const coinsDisplay = document.getElementById('coins');
        const gameOverScreen = document.getElementById('game-over');
        const gameOverClose = document.getElementById('game-over-close');
        const finalScoreDisplay = document.getElementById('final-score');
        const finalCoinsDisplay = document.getElementById('final-coins');
        const restartBtn = document.getElementById('restart-btn');
        const shopBtnModal = document.getElementById('shop-btn-modal');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const themeToggle = document.getElementById('theme-toggle');
        const soundToggle = document.getElementById('sound-toggle');
        const musicToggle = document.getElementById('music-toggle');
        const shopButton = document.getElementById('shop-button');
        const profileButton = document.getElementById('profile-button');
        const shopModal = document.getElementById('shop-modal');
        const shopClose = document.getElementById('shop-close');
        const modalOverlay = document.getElementById('modal-overlay');
        const characterList = document.getElementById('character-list');
        const shopCoinsDisplay = document.getElementById('shop-coins');
        const ownedCountDisplay = document.getElementById('owned-count');
        const totalCountDisplay = document.getElementById('total-count');
        const startButton = document.getElementById('start-button');
        const mobileJumpButton = document.getElementById('mobile-jump');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const authContainer = document.getElementById('auth-container');
        const loginButton = document.getElementById('login-button');
        const registerButton = document.getElementById('register-button');
        const loginModal = document.getElementById('login-modal');
        const loginClose = document.getElementById('login-close');
        const loginUsername = document.getElementById('login-username');
        const loginPassword = document.getElementById('login-password');
        const loginSubmit = document.getElementById('login-submit');
        const loginMessage = document.getElementById('login-message');
        const registerModal = document.getElementById('register-modal');
        const registerClose = document.getElementById('register-close');
        const registerUsername = document.getElementById('register-username');
        const registerPassword = document.getElementById('register-password');
        const registerConfirm = document.getElementById('register-confirm');
        const registerSubmit = document.getElementById('register-submit');
        const registerMessage = document.getElementById('register-message');
        const toRegister = document.getElementById('to-register');
        const toLogin = document.getElementById('to-login');
        const profileModal = document.getElementById('profile-modal');
        const profileClose = document.getElementById('profile-close');
        const profileUsername = document.getElementById('profile-username');
        const profileCoins = document.getElementById('profile-coins');
        const profileHighscore = document.getElementById('profile-highscore');
        const profileGames = document.getElementById('profile-games');
        const profileTime = document.getElementById('profile-time');
        const logoutButton = document.getElementById('logout-button');
        
        // –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã
        const backgroundMusic = document.getElementById('background-music');
        const jumpSound = document.getElementById('jump-sound');
        const coinSound = document.getElementById('coin-sound');
        const gameOverSound = document.getElementById('game-over-sound');
        const purchaseSound = document.getElementById('purchase-sound');
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∑–≤—É–∫–æ–≤
        backgroundMusic.src = SOUNDS.background;
        jumpSound.src = SOUNDS.jump;
        coinSound.src = SOUNDS.coin;
        gameOverSound.src = SOUNDS.gameOver;
        purchaseSound.src = SOUNDS.purchase;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let activeCharacter = null;
        let gameSpeed = 10; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Å 7 –¥–æ 10
        let backgroundPos = 0;
        let score = 0;
        let coinCount = 0;
        let currentLevel = 1;
        let gameStartTime = 0;
        let gameTime = 0;
        let isJumping = false;
        let isGameOver = false;
        let isGameStarted = false;
        let debugMode = false;
        let gameLoop;
        
        // –ú–∞—Å—Å–∏–≤—ã –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        let obstacles = [];
        let coins = [];
        let bonuses = [];
        
        // –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
        let obstacleInterval = 1800; // 1.8 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ (–±—ã–ª–æ 2)
        let coinInterval = 1200; // 1.2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –º–æ–Ω–µ—Ç–∞–º–∏ (–±—ã–ª–æ 1.5)
        let bonusInterval = 12000; // 12 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –±–æ–Ω—É—Å–∞–º–∏ (–±—ã–ª–æ 15)
        let nextObstacleTime = 0;
        let nextCoinTime = 0;
        let nextBonusTime = 0;
        
        // –°–æ—Å—Ç–æ—è–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
        let hasShield = false;
        let hasMagnet = false;
        let hasSlowMotion = false;
        let shieldTimer, magnetTimer, slowTimer;
        
        // –ó–≤—É–∫
        let soundEnabled = true;
        let musicPlaying = false;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateAuthUI() {
            const authContainer = document.getElementById('auth-container');
            
            // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            authContainer.innerHTML = '';
            
            if (gameAPI.currentUser) {
                // –°–æ–∑–¥–∞–µ–º UI –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userProfile = document.createElement('div');
                userProfile.className = 'user-profile';
                
                // –ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∏–º–µ–Ω–∏)
                const avatar = document.createElement('div');
                avatar.className = 'profile-avatar';
                avatar.textContent = gameAPI.currentUser.username.charAt(0).toUpperCase();
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const details = document.createElement('div');
                details.className = 'profile-details';
                
                const name = document.createElement('div');
                name.className = 'profile-name';
                name.textContent = gameAPI.currentUser.username;
                
                const stats = document.createElement('div');
                stats.className = 'profile-stats';
                stats.textContent = `${gameAPI.currentUser.coins} –º–æ–Ω–µ—Ç ‚Ä¢ –†–µ–∫–æ—Ä–¥: ${gameAPI.currentUser.highScore}`;
                
                details.appendChild(name);
                details.appendChild(stats);
                
                // –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
                const menu = document.createElement('div');
                menu.className = 'profile-menu';
                
                // –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é
                const profileItem = document.createElement('div');
                profileItem.className = 'profile-menu-item';
                profileItem.textContent = '–ü—Ä–æ—Ñ–∏–ª—å';
                profileItem.addEventListener('click', function() {
                    showProfileModal();
                });
                
                const logoutItem = document.createElement('div');
                logoutItem.className = 'profile-menu-item logout';
                logoutItem.textContent = '–í—ã–π—Ç–∏';
                logoutItem.addEventListener('click', function() {
                    const result = gameAPI.logout();
                    if (result.success) {
                        updateAuthUI();
                        createShopItems();
                        initPlayerImage();
                    }
                });
                
                menu.appendChild(profileItem);
                menu.appendChild(logoutItem);
                
                // –°–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤–º–µ—Å—Ç–µ
                userProfile.appendChild(avatar);
                userProfile.appendChild(details);
                userProfile.appendChild(menu);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é
                userProfile.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const menu = this.querySelector('.profile-menu');
                    const rect = this.getBoundingClientRect();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
                    menu.style.top = (rect.bottom + 5) + 'px';
                    menu.style.right = (window.innerWidth - rect.right) + 'px';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                    const isDisplayed = menu.style.display === 'block';
                    menu.style.display = isDisplayed ? 'none' : 'block';
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                    setTimeout(() => {
                        menu.style.opacity = isDisplayed ? '0' : '1';
                        menu.style.transform = isDisplayed ? 'translateY(-10px)' : 'translateY(0)';
                    }, 10);
                });
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤ –¥—Ä—É–≥—É—é –æ–±–ª–∞—Å—Ç—å
                document.addEventListener('click', function(e) {
                    const menu = document.querySelector('.profile-menu');
                    if (menu && menu.style.display === 'block' && !e.target.closest('.user-profile')) {
                        menu.style.opacity = '0';
                        menu.style.transform = 'translateY(-10px)';
                        setTimeout(() => {
                            menu.style.display = 'none';
                        }, 300);
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
                userProfile.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    const menu = this.querySelector('.profile-menu');
                    const rect = this.getBoundingClientRect();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
                    menu.style.top = (rect.bottom + 5) + 'px';
                    menu.style.right = (window.innerWidth - rect.right) + 'px';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                    const isDisplayed = menu.style.display === 'block';
                    menu.style.display = isDisplayed ? 'none' : 'block';
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                    setTimeout(() => {
                        menu.style.opacity = isDisplayed ? '0' : '1';
                        menu.style.transform = isDisplayed ? 'translateY(-10px)' : 'translateY(0)';
                    }, 10);
                });
                
                authContainer.appendChild(userProfile);
                
                // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ñ–∏–ª—è
                profileButton.style.display = 'inline-block';
            } else {
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const loginButton = document.createElement('button');
                loginButton.id = 'login-button';
                loginButton.className = 'game-button';
                loginButton.textContent = '–í–æ–π—Ç–∏';
                loginButton.addEventListener('click', showLoginModal);
                
                const registerButton = document.createElement('button');
                registerButton.id = 'register-button';
                registerButton.className = 'game-button';
                registerButton.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
                registerButton.addEventListener('click', showRegisterModal);
                
                authContainer.appendChild(loginButton);
                authContainer.appendChild(registerButton);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ—Ñ–∏–ª—è
                profileButton.style.display = 'none';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateProfileModal() {
            if (gameAPI.currentUser) {
                profileUsername.textContent = gameAPI.currentUser.username;
                profileCoins.textContent = gameAPI.currentUser.coins;
                profileHighscore.textContent = gameAPI.currentUser.highScore;
                profileGames.textContent = gameAPI.currentUser.gamesPlayed;
                profileTime.textContent = gameAPI.currentUser.totalTimeMinutes;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        function toggleTheme() {
            if (themeToggle.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–≤—É–∫–∞
        function toggleSound() {
            soundEnabled = soundToggle.checked;
            localStorage.setItem('sound', soundEnabled ? 'on' : 'off');
            
            if (!soundEnabled) {
                backgroundMusic.pause();
                musicPlaying = false;
                musicToggle.textContent = 'üîá';
            } else if (isGameStarted && !isGameOver) {
                musicToggle.textContent = 'üîä';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏
        function toggleMusic() {
            if (soundEnabled) {
                if (musicPlaying) {
                    backgroundMusic.pause();
                    musicPlaying = false;
                    musicToggle.textContent = 'üîá';
                } else {
                    backgroundMusic.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                    musicPlaying = true;
                    musicToggle.textContent = 'üîä';
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
        async function updateLeaderboard() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
            leaderboardBody.innerHTML = '<tr><td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>';
            
            // –ü–æ–ª—É—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const globalLeaderboard = await gameAPI.getGlobalLeaderboard();
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Ç–∞–±–ª–∏—Ü—É
            leaderboardBody.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
            if (globalLeaderboard.length > 0) {
                globalLeaderboard.forEach(entry => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${entry.rank}</td>
                        <td>${entry.username}</td>
                        <td>${entry.highScore}</td>
                        <td>${entry.gamesPlayed}</td>
                        <td>${entry.date}</td>
                    `;
                    
                    leaderboardBody.appendChild(row);
                });
            } else {
                // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                leaderboardBody.innerHTML = '<tr><td colspan="5">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</td></tr>';
            }
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        async function setActiveCharacter(characterId) {
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
            const character = CHARACTERS.find(char => char.id === characterId);
            if (!character) return;
            
            if (gameAPI.currentUser) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                const result = await gameAPI.setActiveCharacter(characterId);
                
                if (result.success) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    activeCharacter = character;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    player.src = character.image;
                    player.style.width = character.width + 'px';
                    player.style.height = character.height + 'px';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                    if (character.sounds) {
                        jumpSound.src = character.sounds.jump || SOUNDS.jump;
                        coinSound.src = character.sounds.coin || SOUNDS.coin;
                        gameOverSound.src = character.sounds.gameOver || SOUNDS.gameOver;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
                    createShopItems();
                }
            } else {
                // –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∑–≤—É–∫–∏
                activeCharacter = character;
                player.src = character.image;
                player.style.width = character.width + 'px';
                player.style.height = character.height + 'px';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (character.sounds) {
                    jumpSound.src = character.sounds.jump || SOUNDS.jump;
                    coinSound.src = character.sounds.coin || SOUNDS.coin;
                    gameOverSound.src = character.sounds.gameOver || SOUNDS.gameOver;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –≤ localStorage
                localStorage.setItem('guestActiveCharacter', characterId);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
        function createShopItems() {
            characterList.innerHTML = '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–∏—Å–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            let unlockedCharacters = ['default'];
            let activeCharacterId = 'default';
            
            if (gameAPI.currentUser) {
                unlockedCharacters = gameAPI.currentUser.characters;
                activeCharacterId = gameAPI.currentUser.activeCharacter;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
                shopCoinsDisplay.textContent = gameAPI.currentUser.coins;
                ownedCountDisplay.textContent = unlockedCharacters.length;
            } else {
                // –î–ª—è –≥–æ—Å—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                activeCharacterId = localStorage.getItem('guestActiveCharacter') || 'default';
                shopCoinsDisplay.textContent = '0 (–≥–æ—Å—Ç—å)';
                ownedCountDisplay.textContent = '1';
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            CHARACTERS.forEach(character => {
                const isUnlocked = unlockedCharacters.includes(character.id);
                const isActive = activeCharacterId === character.id;
                
                const characterItem = document.createElement('div');
                characterItem.className = `shop-item ${isActive ? 'selected' : ''}`;
                characterItem.dataset.id = character.id;
                
                const characterImage = document.createElement('img');
                characterImage.src = character.image;
                characterImage.className = 'character-preview';
                characterImage.alt = character.name;
                
                const characterName = document.createElement('div');
                characterName.className = 'character-name';
                characterName.textContent = character.name;
                
                const characterPrice = document.createElement('div');
                characterPrice.className = 'character-price';
                
                if (character.price > 0) {
                    const coinIcon = document.createElement('div');
                    coinIcon.className = 'coin-icon';
                    
                    const priceText = document.createElement('span');
                    priceText.textContent = character.price;
                    
                    characterPrice.appendChild(coinIcon);
                    characterPrice.appendChild(priceText);
                } else {
                    characterPrice.textContent = '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ';
                }
                
                const characterActions = document.createElement('div');
                characterActions.className = 'character-actions';
                
                if (isUnlocked) {
                    // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞
                    const selectButton = document.createElement('button');
                    selectButton.className = 'select-button';
                    selectButton.textContent = isActive ? '–í—ã–±—Ä–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å';
                    selectButton.disabled = isActive;
                    
                    selectButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        setActiveCharacter(character.id);
                    });
                    
                    characterActions.appendChild(selectButton);
                } else if (gameAPI.currentUser) {
                    // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
                    const buyButton = document.createElement('button');
                    buyButton.className = 'buy-button';
                    buyButton.textContent = '–ö—É–ø–∏—Ç—å';
                    buyButton.disabled = gameAPI.currentUser.coins < character.price;
                    
                    buyButton.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        
                        // –ü–æ–∫—É–ø–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —á–µ—Ä–µ–∑ API
                        const result = await gameAPI.buyCharacter(character.id);
                        
                        if (result.success) {
                            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –ø–æ–∫—É–ø–∫–∏
                            if (soundEnabled && purchaseSound.src) {
                                purchaseSound.currentTime = 0;
                                purchaseSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                            }
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                            createShopItems();
                            updateAuthUI();
                        } else {
                            alert(result.message);
                        }
                    });
                    
                    characterActions.appendChild(buyButton);
                } else {
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ö–æ–¥–∞
                    const loginButton = document.createElement('button');
                    loginButton.className = 'buy-button';
                    loginButton.textContent = '–í–æ–π–¥–∏—Ç–µ';
                    
                    loginButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        closeShop();
                        showLoginModal();
                    });
                    
                    characterActions.appendChild(loginButton);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                characterItem.appendChild(characterImage);
                characterItem.appendChild(characterName);
                characterItem.appendChild(characterPrice);
                characterItem.appendChild(characterActions);
                
                characterList.appendChild(characterItem);
            });
            
            totalCountDisplay.textContent = CHARACTERS.length;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
        function initPlayerImage() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            let characterId = 'default';
            
            if (gameAPI.currentUser) {
                characterId = gameAPI.currentUser.activeCharacter;
            } else {
                characterId = localStorage.getItem('guestActiveCharacter') || 'default';
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
            const character = CHARACTERS.find(char => char.id === characterId);
            if (character) {
                activeCharacter = character;
                player.src = character.image;
                player.style.width = character.width + 'px';
                player.style.height = character.height + 'px';
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–≤—É–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                if (character.sounds) {
                    jumpSound.src = character.sounds.jump || SOUNDS.jump;
                    coinSound.src = character.sounds.coin || SOUNDS.coin;
                    gameOverSound.src = character.sounds.gameOver || SOUNDS.gameOver;
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        async function init() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É –∏–∑ localStorage
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                themeToggle.checked = true;
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞ –∏–∑ localStorage
            const savedSound = localStorage.getItem('sound') || 'on';
            soundToggle.checked = savedSound === 'on';
            soundEnabled = savedSound === 'on';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            initPlayerImage();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            updateAuthUI();
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞–≥–∞–∑–∏–Ω–∞
            createShopItems();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            await updateLeaderboard();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            themeToggle.addEventListener('change', toggleTheme);
            soundToggle.addEventListener('change', toggleSound);
            musicToggle.addEventListener('click', toggleMusic);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä—ã–∂–∫–∞ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø—Ä–æ–±–µ–ª–∞
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space') {
                    event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                    if (!isJumping && isGameStarted && !isGameOver) {
                        jump();
                    }
                } else if (event.key === 'ArrowUp' && !isJumping && isGameStarted && !isGameOver) {
                    event.preventDefault();
                    jump();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            gameContainer.addEventListener('touchstart', function(e) {
                if (!isJumping && isGameStarted && !isGameOver) {
                    e.preventDefault();
                    jump();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –ø—Ä—ã–∂–∫–∞
            mobileJumpButton.addEventListener('touchstart', function(e) {
                if (!isJumping && isGameStarted && !isGameOver) {
                    e.preventDefault();
                    jump();
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã
            startButton.addEventListener('click', function() {
                if (!isGameStarted || isGameOver) {
                    startGame();
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
            restartBtn.addEventListener('click', function() {
                saveScore();
                restartGame();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–≥—Ä—ã –æ–∫–æ–Ω—á–µ–Ω–∞
            gameOverClose.addEventListener('click', function() {
                saveScore();
                closeGameOver();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            shopBtnModal.addEventListener('click', function() {
                saveScore();
                closeGameOver();
                openShop();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞
            shopButton.addEventListener('click', openShop);
            shopClose.addEventListener('click', closeShop);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            loginButton.addEventListener('click', showLoginModal);
            registerButton.addEventListener('click', showRegisterModal);
            loginClose.addEventListener('click', closeLoginModal);
            registerClose.addEventListener('click', closeRegisterModal);
            toRegister.addEventListener('click', function() {
                closeLoginModal();
                showRegisterModal();
            });
            toLogin.addEventListener('click', function() {
                closeRegisterModal();
                showLoginModal();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
            loginSubmit.addEventListener('click', async function() {
                const username = loginUsername.value.trim();
                const password = loginPassword.value;
                
                if (!username || !password) {
                    showMessage(loginMessage, "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
                    return;
                }
                
                const result = await gameAPI.login(username, password);
                
                if (result.success) {
                    showMessage(loginMessage, result.message, "success");
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
                    setTimeout(() => {
                        closeLoginModal();
                        updateAuthUI();
                        createShopItems();
                    }, 1000);
                } else {
                    showMessage(loginMessage, result.message, "error");
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            registerSubmit.addEventListener('click', async function() {
                const username = registerUsername.value.trim();
                const password = registerPassword.value;
                const confirm = registerConfirm.value;
                
                if (!username || !password || !confirm) {
                    showMessage(registerMessage, "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è", "error");
                    return;
                }
                
                if (password !== confirm) {
                    showMessage(registerMessage, "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç", "error");
                    return;
                }
                
                const result = await gameAPI.register(username, password);
                
                if (result.success) {
                    showMessage(registerMessage, result.message, "success");
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    setTimeout(() => {
                        closeRegisterModal();
                        updateAuthUI();
                        createShopItems();
                    }, 1000);
                } else {
                    showMessage(registerMessage, result.message, "error");
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
            profileButton.addEventListener('click', showProfileModal);
            profileClose.addEventListener('click', closeProfileModal);
            logoutButton.addEventListener('click', function() {
                const result = gameAPI.logout();
                
                if (result.success) {
                    closeProfileModal();
                    updateAuthUI();
                    createShopItems();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
            modalOverlay.addEventListener('click', function(e) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–∞ —Å–∞–º–æ–º –æ–≤–µ—Ä–ª–µ–µ, –∞ –Ω–µ –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                if (e.target === modalOverlay) {
                    closeAllModals();
                }
            });
            
            // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø—Ä–æ–±–µ–ª–∞
            window.addEventListener('keydown', function(e) {
                if(e.code === 'Space' && e.target === document.body) {
                    e.preventDefault();
                }
            });
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = `message ${type}`;
            element.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
        function showLoginModal() {
            loginModal.style.display = 'block';
            modalOverlay.style.display = 'block';
            loginMessage.style.display = 'none';
            loginUsername.focus();
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
        function closeLoginModal() {
            loginModal.style.display = 'none';
            modalOverlay.style.display = 'none';
            loginUsername.value = '';
            loginPassword.value = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegisterModal() {
            registerModal.style.display = 'block';
            modalOverlay.style.display = 'block';
            registerMessage.style.display = 'none';
            registerUsername.focus();
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function closeRegisterModal() {
            registerModal.style.display = 'none';
            modalOverlay.style.display = 'none';
            registerUsername.value = '';
            registerPassword.value = '';
            registerConfirm.value = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        function showProfileModal() {
            if (gameAPI.currentUser) {
                updateProfileModal();
                profileModal.style.display = 'block';
                modalOverlay.style.display = 'block';
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
        function closeProfileModal() {
            profileModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function closeAllModals() {
            loginModal.style.display = 'none';
            registerModal.style.display = 'none';
            shopModal.style.display = 'none';
            gameOverScreen.style.display = 'none';
            profileModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        function openShop() {
            shopModal.style.display = 'block';
            modalOverlay.style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç
            if (gameAPI.currentUser) {
                shopCoinsDisplay.textContent = gameAPI.currentUser.coins;
            } else {
                shopCoinsDisplay.textContent = '0 (–≥–æ—Å—Ç—å)';
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
        function closeShop() {
            shopModal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞"
        function closeGameOver() {
            gameOverScreen.style.display = 'none';
            modalOverlay.style.display = 'none';
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–æ–≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function createObstacle() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (–º–µ–Ω—å—à–∏–π —à–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø)
            const isGroup = Math.random() < 0.12 && score > 400; // –£–º–µ–Ω—å—à–∏–ª —Å 0.15 –¥–æ 0.12
            
            // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            let availableObstacles = [...OBSTACLES];
            
            // –õ–µ—Ç–∞—é—â–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞
            if (score < 600) {
                availableObstacles = availableObstacles.filter(o => !o.isFlying);
            }
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —É–∂–µ –µ—Å—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, –∏–∑–±–µ–≥–∞–µ–º —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö
            const existingObstacles = obstacles.filter(o => o.x > gameContainer.offsetWidth * 0.7); // –£–≤–µ–ª–∏—á–∏–ª —Å 0.6 –¥–æ 0.7
            if (existingObstacles.length > 0) {
                // –ï—Å–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ, —É–º–µ–Ω—å—à–∞–µ–º —à–∞–Ω—Å —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ - —Å –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤
            const obstacleIndex = Math.floor(Math.random() * availableObstacles.length);
            const obstacleType = availableObstacles[obstacleIndex];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤ –≥—Ä—É–ø–ø–µ (–º–∞–∫—Å 2 –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –∏–≥—Ä—ã)
            const count = isGroup && obstacleType.count ? 
                          Math.min(2, Math.floor(Math.random() * obstacleType.count) + 1) : 1;
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ –≤ –≥—Ä—É–ø–ø–µ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ (–±–æ–ª—å—à–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –ø—Ä—ã–∂–∫–∞)
            const spacing = obstacleType.spacing ? obstacleType.spacing * 1.5 : 90; // –£–≤–µ–ª–∏—á–∏–ª —Å 1.2/70 –¥–æ 1.5/90
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–∂–¥–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ
            for (let i = 0; i < count; i++) {
                const obstacle = document.createElement('img');
                obstacle.src = obstacleType.image;
                obstacle.style.width = obstacleType.width + 'px';
                obstacle.style.height = obstacleType.height + 'px';
                obstacle.classList.add('obstacle');
                
                // –ë–∞–∑–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–ª—é—Å —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –≥—Ä—É–ø–ø
                let posX = gameContainer.offsetWidth + (i * spacing);
                obstacle.style.left = posX + 'px';
                
                // –í—ã—Å–æ—Ç–∞ –¥–ª—è –ª–µ—Ç–∞—é—â–∏—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                let posY = 0;
                if (obstacleType.isFlying) {
                    posY = Math.floor(Math.random() * 
                           (obstacleType.maxHeight - obstacleType.minHeight)) + 
                           obstacleType.minHeight;
                    obstacle.style.bottom = posY + 'px';
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤ DOM
                gameContainer.appendChild(obstacle);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
                obstacles.push({
                    element: obstacle,
                    type: obstacleType.id,
                    x: posX,
                    y: posY,
                    width: obstacleType.width,
                    height: obstacleType.height,
                    hitboxWidth: obstacleType.hitboxWidth,
                    hitboxHeight: obstacleType.hitboxHeight,
                    speed: obstacleType.speed || 1.0,
                    isFlying: obstacleType.isFlying || false
                });
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–µ—Ç–∫–∏ —Å —É—á–µ—Ç–æ–º —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–æ–Ω–µ—Ç
        function createCoin() {
            // –í—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø –º–æ–Ω–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
            let coinType = COINS[0]; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—Ä–æ–Ω–∑–æ–≤–∞—è (–æ–±—ã—á–Ω–∞—è)
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ —Ä–µ–¥–∫–∞—è –º–æ–Ω–µ—Ç–∞
            const rnd = Math.random();
            
            if (rnd < 0.1 && score > 500) { // 10% —à–∞–Ω—Å –∑–æ–ª–æ—Ç–æ–π –ø–æ—Å–ª–µ 500 –æ—á–∫–æ–≤
                coinType = COINS[2]; // –ó–æ–ª–æ—Ç–∞—è
            } else if (rnd < 0.3 && score > 200) { // 20% —à–∞–Ω—Å —Å–µ—Ä–µ–±—Ä—è–Ω–æ–π –ø–æ—Å–ª–µ 200 –æ—á–∫–æ–≤
                coinType = COINS[1]; // –°–µ—Ä–µ–±—Ä—è–Ω–∞—è
            }
            
            const coin = document.createElement('img');
            coin.src = coinType.image;
            coin.style.width = coinType.width + 'px';
            coin.style.height = coinType.height + 'px';
            coin.classList.add('coin');
            coin.style.left = gameContainer.offsetWidth + 'px';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –±—É–¥–µ—Ç –ª–∏ —ç—Ç–æ –ª–∏–Ω–∏—è –º–æ–Ω–µ—Ç
            const isLine = Math.random() < 0.3 && score > 300; // 30% —à–∞–Ω—Å –ª–∏–Ω–∏–∏ –ø–æ—Å–ª–µ 300 –æ—á–∫–æ–≤
            const lineCount = isLine ? Math.floor(Math.random() * 3) + 3 : 1; // 3-5 –º–æ–Ω–µ—Ç –≤ –ª–∏–Ω–∏–∏
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –º–æ–Ω–µ—Ç–∫–∏ (–∞–¥–∞–ø—Ç–∏—Ä—É–µ–º –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
            const containerHeight = gameContainer.offsetHeight;
            const height = Math.floor(Math.random() * (containerHeight / 2.5)) + 40;
            
            // –°–æ–∑–¥–∞–µ–º –ª–∏–Ω–∏—é –º–æ–Ω–µ—Ç –∏–ª–∏ –æ–¥–∏–Ω–æ—á–Ω—É—é –º–æ–Ω–µ—Ç—É
            for (let i = 0; i < lineCount; i++) {
                const coinElement = i === 0 ? coin : coin.cloneNode(true);
                const spacing = 40; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –º–æ–Ω–µ—Ç–∞–º–∏ –≤ –ª–∏–Ω–∏–∏
                
                coinElement.style.left = (gameContainer.offsetWidth + i * spacing) + 'px';
                coinElement.style.bottom = height + 'px';
                
                gameContainer.appendChild(coinElement);
                
                coins.push({
                    element: coinElement,
                    type: coinType.id,
                    x: gameContainer.offsetWidth + i * spacing,
                    y: height,
                    width: coinType.width,
                    height: coinType.height,
                    hitboxWidth: coinType.hitboxWidth,
                    hitboxHeight: coinType.hitboxHeight,
                    value: coinType.value || 1,
                    collected: false
                });
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
        function createBonus() {
            // –ë–æ–Ω—É—Å—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å—á–µ—Ç–∞
            if (Math.random() > 0.05 || score < 500) return; // 5% —à–∞–Ω—Å –ø–æ—Å–ª–µ 500 –æ—á–∫–æ–≤
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –±–æ–Ω—É—Å
            const bonusType = BONUSES[Math.floor(Math.random() * BONUSES.length)];
            
            const bonus = document.createElement('img');
            bonus.src = bonusType.image;
            bonus.style.width = bonusType.width + 'px';
            bonus.style.height = bonusType.height + 'px';
            bonus.classList.add('bonus');
            bonus.style.left = gameContainer.offsetWidth + 'px';
            
            // –†–∞–Ω–¥–æ–º–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –±–æ–Ω—É—Å–∞
            const containerHeight = gameContainer.offsetHeight;
            const height = Math.floor(Math.random() * (containerHeight / 3)) + 60;
            bonus.style.bottom = height + 'px';
            
            gameContainer.appendChild(bonus);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤
            bonuses.push({
                element: bonus,
                type: bonusType.id,
                effect: bonusType.effect,
                duration: bonusType.duration,
                x: gameContainer.offsetWidth,
                y: height,
                width: bonusType.width,
                height: bonusType.height,
                hitboxWidth: bonusType.hitboxWidth,
                hitboxHeight: bonusType.hitboxHeight,
                collected: false
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function startGame() {
            // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            score = 0;
            coinCount = 0;
            gameSpeed = 10; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Å 7 –¥–æ 10
            backgroundPos = 0;
            currentLevel = 1;
            gameStartTime = Date.now();
            gameTime = 0;
            
            // –ú–∞—Å—Å–∏–≤—ã –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            obstacles = [];
            coins = [];
            bonuses = [];
            
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            isGameOver = false;
            isGameStarted = true;
            debugMode = false; // –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–∏—Ç–±–æ–∫—Å—ã)
            
            // –°–æ—Å—Ç–æ—è–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
            hasShield = false;
            hasMagnet = false;
            hasSlowMotion = false;
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä—ã, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã
            clearTimeout(shieldTimer);
            clearTimeout(magnetTimer);
            clearTimeout(slowTimer);
            
            // –î–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫—É –ø—Ä—ã–∂–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            mobileJumpButton.style.display = 'block';
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ –∏–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
            document.querySelectorAll('.obstacle, .coin, .bonus, .explosion, .floating-text, .level-up-container').forEach(el => el.remove());
            
            // –û—á–∏—â–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ö–∏—Ç–±–æ–∫—Å—ã
            document.querySelectorAll('[id^="player-hitbox"], [id^="obstacle-hitbox"], [id^="coin-hitbox"], [id^="bonus-hitbox"]').forEach(el => el.remove());
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            scoreDisplay.textContent = score;
            coinsDisplay.textContent = coinCount;
            gameOverScreen.style.display = 'none';
            modalOverlay.style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            if (player) {
                player.style.filter = 'none';
            }
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ—è–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            nextObstacleTime = performance.now() + 2000; // 2 —Å–µ–∫—É–Ω–¥—ã –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è (–±—ã–ª–æ 2.5)
            nextCoinTime = performance.now() + 800; // 0.8 —Å–µ–∫—É–Ω–¥—ã –¥–æ –ø–µ—Ä–≤–æ–π –º–æ–Ω–µ—Ç—ã (–±—ã–ª–æ 1)
            nextBonusTime = performance.now() + 8000; // 8 —Å–µ–∫—É–Ω–¥ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –±–æ–Ω—É—Å–∞ (–±—ã–ª–æ 10)
            
            obstacleInterval = 1800; // 1.8 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ (–±—ã–ª–æ 2)
            coinInterval = 1200; // 1.2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –º–æ–Ω–µ—Ç–∞–º–∏ (–±—ã–ª–æ 1.5)
            bonusInterval = 12000; // 12 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –±–æ–Ω—É—Å–∞–º–∏ (–±—ã–ª–æ 15)
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É, –µ—Å–ª–∏ –∑–≤—É–∫ –≤–∫–ª—é—á–µ–Ω
            if (soundEnabled && !musicPlaying) {
                toggleMusic();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é
            showStartAnimation();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop = requestAnimationFrame(update);
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∞–Ω–∏–º–∞—Ü–∏—é
        function showStartAnimation() {
            const startCountdown = document.createElement('div');
            startCountdown.className = 'start-countdown';
            startCountdown.style.position = 'absolute';
            startCountdown.style.top = '50%';
            startCountdown.style.left = '50%';
            startCountdown.style.transform = 'translate(-50%, -50%)';
            startCountdown.style.color = '#fff';
            startCountdown.style.fontSize = '48px';
            startCountdown.style.fontWeight = 'bold';
            startCountdown.style.textShadow = '2px 2px 4px rgba(0, 0, 0, 0.5)';
            startCountdown.style.zIndex = '5';
            startCountdown.style.transition = 'transform 0.25s, opacity 0.25s'; // –£—Å–∫–æ—Ä–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—é –≤ 2 —Ä–∞–∑–∞
            startCountdown.textContent = '3';
            
            gameContainer.appendChild(startCountdown);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞ (—É—Å–∫–æ—Ä–µ–Ω–∞ –≤ 2 —Ä–∞–∑–∞)
            setTimeout(() => {
                startCountdown.style.transform = 'translate(-50%, -50%) scale(1.5)';
                startCountdown.style.opacity = '0';
                
                setTimeout(() => {
                    startCountdown.style.transform = 'translate(-50%, -50%) scale(1)';
                    startCountdown.style.opacity = '1';
                    startCountdown.textContent = '2';
                    
                    setTimeout(() => {
                        startCountdown.style.transform = 'translate(-50%, -50%) scale(1.5)';
                        startCountdown.style.opacity = '0';
                        
                        setTimeout(() => {
                            startCountdown.style.transform = 'translate(-50%, -50%) scale(1)';
                            startCountdown.style.opacity = '1';
                            startCountdown.textContent = '1';
                            
                            setTimeout(() => {
                                startCountdown.style.transform = 'translate(-50%, -50%) scale(1.5)';
                                startCountdown.style.opacity = '0';
                                
                                setTimeout(() => {
                                    startCountdown.style.transform = 'translate(-50%, -50%) scale(1)';
                                    startCountdown.style.opacity = '1';
                                    startCountdown.textContent = 'GO!';
                                    startCountdown.style.color = activeCharacter.color || '#4285f4';
                                    
                                    setTimeout(() => {
                                        startCountdown.style.transform = 'translate(-50%, -50%) scale(2)';
                                        startCountdown.style.opacity = '0';
                                        
                                        setTimeout(() => {
                                            startCountdown.remove();
                                        }, 250);
                                    }, 250);
                                }, 250);
                            }, 250);
                        }, 250);
                    }, 250);
                }, 250);
            }, 250);
        }
        
        // –ü—Ä—ã–∂–æ–∫ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function jump() {
            if (!activeCharacter) return;
            
            // –ï—Å–ª–∏ —É–∂–µ –≤ –ø—Ä—ã–∂–∫–µ, –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ–º –ø—Ä—ã–≥–∞—Ç—å —Å–Ω–æ–≤–∞
            if (isJumping) return;
            
            isJumping = true;
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª—å –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä—ã–∂–∫–∞
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –≤—ã—Å–æ—Ç—É –ø—Ä—ã–∂–∫–∞ –Ω–∞ 25% –¥–ª—è –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            const jumpHeight = (activeCharacter.jumpHeight || 150) * 1.25;
            const jumpDuration = 600; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä—ã–∂–∫–∞ –¥–ª—è –±–æ–ª–µ–µ –¥–æ–ª–≥–æ–≥–æ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –≤ –≤–æ–∑–¥—É—Ö–µ (–±—ã–ª–æ 450)
            
            // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∏–ª—å
            let jumpStyle = document.getElementById('jump-style');
            if (!jumpStyle) {
                jumpStyle = document.createElement('style');
                jumpStyle.id = 'jump-style';
                document.head.appendChild(jumpStyle);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å —Å –Ω–æ–≤–æ–π –≤—ã—Å–æ—Ç–æ–π –ø—Ä—ã–∂–∫–∞ –∏ –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫—Ä–∏–≤—É—é –±–µ–∑—å–µ, —á—Ç–æ–±—ã –ø–µ—Ä—Å–æ–Ω–∞–∂ –¥–æ–ª—å—à–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è –≤ –≤–µ—Ä—Ö–Ω–µ–π —Ç–æ—á–∫–µ –ø—Ä—ã–∂–∫–∞
            jumpStyle.textContent = `
                @keyframes jump {
                    0% { bottom: 0; }
                    40% { bottom: ${jumpHeight}px; }
                    60% { bottom: ${jumpHeight}px; }
                    100% { bottom: 0; }
                }
                .jumping {
                    animation: jump ${jumpDuration}ms cubic-bezier(0.33, 0.1, 0.67, 1);
                }
            `;
            
            player.classList.add('jumping');
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∑–≤—É–∫ –ø—Ä—ã–∂–∫–∞
            if (soundEnabled) {
                const soundSrc = activeCharacter.sounds && activeCharacter.sounds.jump ?
                              activeCharacter.sounds.jump : SOUNDS.jump;
                                
                if (jumpSound.src !== soundSrc) {
                    jumpSound.src = soundSrc;
                }
                
                jumpSound.currentTime = 0;
                jumpSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            setTimeout(() => {
                player.classList.remove('jumping');
                isJumping = false;
            }, jumpDuration);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å —É—á–µ—Ç–æ–º —Ö–∏—Ç–±–æ–∫—Å–æ–≤ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä—É
        function checkCollisions() {
            if (!activeCharacter) return;
            
            // –°–æ–∑–¥–∞–µ–º —Ö–∏—Ç–±–æ–∫—Å –¥–ª—è –∏–≥—Ä–æ–∫–∞ —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞–π—Ç–∞ –¥–ª—è –±–æ–ª—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
            const playerOffset = (activeCharacter.width - activeCharacter.hitboxWidth) / 2;
            const playerRect = {
                x: 50 + playerOffset, // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å
                y: isJumping ? getJumpHeight() : 0,
                width: activeCharacter.hitboxWidth,
                height: activeCharacter.hitboxHeight
            };
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –∏–≥—Ä–æ–∫–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
            if (debugMode) {
                drawHitbox(playerRect.x, playerRect.y, playerRect.width, playerRect.height, 'player-hitbox', 'rgba(0, 255, 0, 0.5)');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
            for (let i = 0; i < obstacles.length; i++) {
                const obstacle = obstacles[i];
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞–π—Ç–∞ –¥–ª—è –±–æ–ª—å—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
                const obstacleOffset = (obstacle.width - obstacle.hitboxWidth) / 2;
                
                // –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è –ª–µ—Ç–∞—é—â–∏—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                const obstacleY = obstacle.isFlying ? obstacle.y : 0;
                
                const obstacleRect = {
                    x: obstacle.x + obstacleOffset, // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ö–∏—Ç–±–æ–∫—Å
                    y: obstacleY,
                    width: obstacle.hitboxWidth,
                    height: obstacle.hitboxHeight
                };
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
                if (debugMode) {
                    drawHitbox(obstacleRect.x, obstacleY, obstacleRect.width, obstacleRect.height, 
                              `obstacle-hitbox-${i}`, 'rgba(255, 0, 0, 0.5)');
                }
                
                // –î–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –∏–≥—Ä—ã (5% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ö–∏—Ç–±–æ–∫—Å–∞)
                const tolerance = Math.min(obstacleRect.width, obstacleRect.height) * 0.05;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤ —Å —É—á–µ—Ç–æ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏
                if (
                    playerRect.x + tolerance < obstacleRect.x + obstacleRect.width - tolerance &&
                    playerRect.x + playerRect.width - tolerance > obstacleRect.x + tolerance &&
                    playerRect.y + tolerance < obstacleRect.y + obstacleRect.height - tolerance &&
                    playerRect.y + playerRect.height - tolerance > obstacleRect.y + tolerance
                ) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —â–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä—É
                    if (hasShield) {
                        useShield(obstacle);
                        return;
                    }
                    
                    gameOver();
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç–æ–∫
            for (let i = 0; i < coins.length; i++) {
                const coin = coins[i];
                if (coin.collected) continue;
                
                const coinRect = {
                    x: coin.x,
                    y: coin.y,
                    width: coin.hitboxWidth,
                    height: coin.hitboxHeight
                };
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –º–æ–Ω–µ—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
                if (debugMode) {
                    drawHitbox(coin.x, coin.y, coinRect.width, coinRect.height, 
                              `coin-hitbox-${i}`, 'rgba(255, 255, 0, 0.5)');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤
                if (
                    playerRect.x < coinRect.x + coinRect.width &&
                    playerRect.x + playerRect.width > coinRect.x &&
                    playerRect.y < coinRect.y + coinRect.height &&
                    playerRect.y + playerRect.height > coinRect.y
                ) {
                    collectCoin(coin);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –±–æ–Ω—É—Å–æ–≤
            for (let i = 0; i < bonuses.length; i++) {
                const bonus = bonuses[i];
                if (bonus.collected) continue;
                
                const bonusRect = {
                    x: bonus.x,
                    y: bonus.y,
                    width: bonus.hitboxWidth,
                    height: bonus.hitboxHeight
                };
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–∞ –±–æ–Ω—É—Å–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
                if (debugMode) {
                    drawHitbox(bonus.x, bonus.y, bonusRect.width, bonusRect.height, 
                              `bonus-hitbox-${i}`, 'rgba(0, 255, 255, 0.5)');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Ö–∏—Ç–±–æ–∫—Å–æ–≤
                if (
                    playerRect.x < bonusRect.x + bonusRect.width &&
                    playerRect.x + playerRect.width > bonusRect.x &&
                    playerRect.y < bonusRect.y + bonusRect.height &&
                    playerRect.y + playerRect.height > bonusRect.y
                ) {
                    collectBonus(bonus);
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ö–∏—Ç–±–æ–∫—Å–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function drawHitbox(x, y, width, height, id, color) {
            let hitbox = document.getElementById(id);
            if (!hitbox) {
                hitbox = document.createElement('div');
                hitbox.id = id;
                hitbox.style.position = 'absolute';
                hitbox.style.pointerEvents = 'none';
                hitbox.style.zIndex = '100';
                gameContainer.appendChild(hitbox);
            }
            
            hitbox.style.left = x + 'px';
            hitbox.style.bottom = y + 'px';
            hitbox.style.width = width + 'px';
            hitbox.style.height = height + 'px';
            hitbox.style.backgroundColor = color;
            hitbox.style.border = '1px solid white';
        }
        
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —â–∏—Ç–∞ –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏
        function useShield(obstacle) {
            hasShield = false;
            
            // –£–¥–∞–ª—è–µ–º —â–∏—Ç
            const shieldElement = document.getElementById('player-shield');
            if (shieldElement) shieldElement.remove();
            
            // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä —â–∏—Ç–∞
            clearTimeout(shieldTimer);
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ, —Å –∫–æ—Ç–æ—Ä—ã–º —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å
            const obstacleIndex = obstacles.indexOf(obstacle);
            if (obstacleIndex !== -1) {
                obstacle.element.remove();
                obstacles.splice(obstacleIndex, 1);
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.position = 'absolute';
            explosion.style.left = obstacle.x + 'px';
            explosion.style.bottom = (obstacle.isFlying ? obstacle.y : 0) + 'px';
            explosion.style.width = obstacle.width * 1.5 + 'px';
            explosion.style.height = obstacle.height * 1.5 + 'px';
            explosion.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
            explosion.style.borderRadius = '50%';
            explosion.style.zIndex = '3';
            explosion.style.pointerEvents = 'none';
            explosion.style.transition = 'transform 0.3s, opacity 0.3s';
            explosion.style.opacity = '1';
            explosion.style.transform = 'scale(0.5)';
            
            gameContainer.appendChild(explosion);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤–∑—Ä—ã–≤–∞
            setTimeout(() => {
                explosion.style.transform = 'scale(2)';
                explosion.style.opacity = '0';
            }, 50);
            
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                explosion.remove();
            }, 350);
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
            if (soundEnabled && SOUNDS.shieldEnd) {
                const shieldEndSound = new Audio(SOUNDS.shieldEnd);
                shieldEndSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            // –î–∞–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å –∫ —Å—á–µ—Ç—É
            score += 100;
            scoreDisplay.textContent = score;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é +100
            showFloatingText('+100', obstacle.x, (obstacle.isFlying ? obstacle.y : 30), '#00ffff');
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤—ã—Å–æ—Ç—ã –ø—Ä—ã–∂–∫–∞ (–¥–ª—è –∫–æ–ª–ª–∏–∑–∏–π)
        function getJumpHeight() {
            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –¥–ª—è –Ω–æ–≤–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä—ã–∂–∫–∞ 600–º—Å
            const jumpTime = Date.now() % 600;
            let jumpProgress;
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º —Ç—É –∂–µ –∫—Ä–∏–≤—É—é –ø—Ä—ã–∂–∫–∞, —á—Ç–æ –∏ –≤ CSS-–∞–Ω–∏–º–∞—Ü–∏–∏
            if (jumpTime < 240) { // –ü–µ—Ä–≤—ã–µ 40% –≤—Ä–µ–º–µ–Ω–∏ - –ø–æ–¥—ä–µ–º
                jumpProgress = jumpTime / 240;
                return Math.sin(jumpProgress * Math.PI/2) * (gameContainer.offsetHeight * 0.7);
            } else if (jumpTime < 360) { // –°–ª–µ–¥—É—é—â–∏–µ 20% - –∑–∞–≤–∏—Å–∞–Ω–∏–µ –≤ –≤–µ—Ä—Ö–Ω–µ–π —Ç–æ—á–∫–µ
                return gameContainer.offsetHeight * 0.7;
            } else { // –û—Å—Ç–∞–≤—à–∏–µ—Å—è 40% - —Å–ø—É—Å–∫
                jumpProgress = (jumpTime - 360) / 240;
                return Math.sin((1 - jumpProgress) * Math.PI/2) * (gameContainer.offsetHeight * 0.7);
            }
        }
        
        // –°–±–æ—Ä –º–æ–Ω–µ—Ç–∫–∏ —Å —É—á–µ—Ç–æ–º –µ–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        function collectCoin(coin) {
            coin.collected = true;
            coin.element.style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const coinValue = coin.value || 1;
            coinCount += coinValue;
            coinsDisplay.textContent = coinCount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é +–• –Ω–∞–¥ –º–æ–Ω–µ—Ç–æ–π
            if (coinValue > 1) {
                showFloatingText(`+${coinValue}`, coin.x, coin.y, coin.type === 'gold' ? '#ffd700' : '#c0c0c0');
            }
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç—ã (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞)
            if (soundEnabled) {
                const soundSrc = activeCharacter && activeCharacter.sounds && activeCharacter.sounds.coin ?
                              activeCharacter.sounds.coin : SOUNDS.coin;
                                
                if (coinSound.src !== soundSrc) {
                    coinSound.src = soundSrc;
                }
                
                coinSound.currentTime = 0;
                coinSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç –∑–∞ –º–æ–Ω–µ—Ç–∫—É (—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã = —Ä–∞–∑–Ω—ã–µ –æ—á–∫–∏)
            const scoreBonus = coinValue * 50;
            score += scoreBonus;
            scoreDisplay.textContent = score;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            checkLevelUp();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        function checkLevelUp() {
            // –ö–∞–∂–¥—ã–µ 500 –æ—á–∫–æ–≤ - –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
            const newLevel = Math.floor(score / 500) + 1;
            
            if (newLevel > currentLevel) {
                currentLevel = newLevel;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
                showLevelUpAnimation(newLevel);
                
                // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —É—Ä–æ–≤–Ω—è
                if (soundEnabled && SOUNDS.levelUp) {
                    const levelUpSound = new Audio(SOUNDS.levelUp);
                    levelUpSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                }
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–∏–π —Ç–µ–∫—Å—Ç
        function showFloatingText(text, x, y, color = '#ffffff') {
            const floatingText = document.createElement('div');
            floatingText.className = 'floating-text';
            floatingText.textContent = text;
            floatingText.style.position = 'absolute';
            floatingText.style.left = x + 'px';
            floatingText.style.bottom = y + 'px';
            floatingText.style.color = color;
            floatingText.style.fontSize = '18px';
            floatingText.style.fontWeight = 'bold';
            floatingText.style.textShadow = '1px 1px 2px rgba(0, 0, 0, 0.5)';
            floatingText.style.zIndex = '5';
            floatingText.style.pointerEvents = 'none';
            floatingText.style.transition = 'transform 0.8s, opacity 0.8s';
            floatingText.style.opacity = '1';
            
            gameContainer.appendChild(floatingText);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥—ä–µ–º–∞ –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            setTimeout(() => {
                floatingText.style.transform = 'translateY(-30px)';
                floatingText.style.opacity = '0';
            }, 50);
            
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                floatingText.remove();
            }, 800);
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        function showLevelUpAnimation(level) {
            const levelUpContainer = document.createElement('div');
            levelUpContainer.className = 'level-up-container';
            levelUpContainer.style.position = 'absolute';
            levelUpContainer.style.top = '50%';
            levelUpContainer.style.left = '50%';
            levelUpContainer.style.transform = 'translate(-50%, -50%)';
            levelUpContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            levelUpContainer.style.color = '#FFD700';
            levelUpContainer.style.padding = '15px 30px';
            levelUpContainer.style.borderRadius = '10px';
            levelUpContainer.style.fontSize = '24px';
            levelUpContainer.style.fontWeight = 'bold';
            levelUpContainer.style.zIndex = '10';
            levelUpContainer.style.pointerEvents = 'none';
            levelUpContainer.style.opacity = '0';
            levelUpContainer.style.transition = 'opacity 0.3s';
            levelUpContainer.textContent = `–£–†–û–í–ï–ù–¨ ${level}!`;
            
            gameContainer.appendChild(levelUpContainer);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
            setTimeout(() => levelUpContainer.style.opacity = '1', 50);
            setTimeout(() => levelUpContainer.style.opacity = '0', 1500);
            setTimeout(() => levelUpContainer.remove(), 1800);
        }
        
        // –°–±–æ—Ä –±–æ–Ω—É—Å–∞
        function collectBonus(bonus) {
            bonus.collected = true;
            bonus.element.style.display = 'none';
            
            // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —Å–±–æ—Ä–∞ –±–æ–Ω—É—Å–∞
            if (soundEnabled && SOUNDS.bonus) {
                const bonusSound = new Audio(SOUNDS.bonus);
                bonusSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –±–æ–Ω—É—Å–∞
            showFloatingText(bonus.effect.toUpperCase(), bonus.x, bonus.y, '#00ffff');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —ç—Ñ—Ñ–µ–∫—Ç –±–æ–Ω—É—Å–∞
            activateBonus(bonus.effect, bonus.duration);
        }
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–æ–Ω—É—Å–∞
        function activateBonus(effect, duration) {
            switch (effect) {
                case 'shield':
                    hasShield = true;
                    
                    // –°–æ–∑–¥–∞–µ–º —â–∏—Ç –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞
                    const shield = document.createElement('div');
                    shield.id = 'player-shield';
                    shield.style.position = 'absolute';
                    shield.style.left = '50px';
                    shield.style.bottom = '0';
                    shield.style.width = (activeCharacter.width + 20) + 'px';
                    shield.style.height = (activeCharacter.height + 20) + 'px';
                    shield.style.borderRadius = '50%';
                    shield.style.border = '3px solid #00ffff';
                    shield.style.boxShadow = '0 0 10px #00ffff';
                    shield.style.zIndex = '1';
                    shield.style.pointerEvents = 'none';
                    
                    gameContainer.appendChild(shield);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
                    shieldTimer = setTimeout(() => {
                        hasShield = false;
                        const shieldElement = document.getElementById('player-shield');
                        if (shieldElement) shieldElement.remove();
                        
                        // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –æ–∫–æ–Ω—á–∞–Ω–∏—è —â–∏—Ç–∞
                        if (soundEnabled && SOUNDS.shieldEnd) {
                            const shieldEndSound = new Audio(SOUNDS.shieldEnd);
                            shieldEndSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                        }
                    }, duration);
                    break;
                    
                case 'slow':
                    const previousSpeed = gameSpeed;
                    gameSpeed *= 0.5; // –ó–∞–º–µ–¥–ª—è–µ–º –∏–≥—Ä—É
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                    gameContainer.style.filter = 'sepia(0.5)';
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                    slowTimer = setTimeout(() => {
                        gameSpeed = previousSpeed;
                        gameContainer.style.filter = 'none';
                    }, duration);
                    break;
                    
                case 'magnet':
                    hasMagnet = true;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –º–∞–≥–Ω–∏—Ç–∞
                    player.style.filter = 'brightness(1.2) drop-shadow(0 0 5px gold)';
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –º–∞–≥–Ω–∏—Ç–∞
                    magnetTimer = setTimeout(() => {
                        hasMagnet = false;
                        player.style.filter = 'none';
                    }, duration);
                    break;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
        function update(timestamp) {
            if (isGameOver) return;
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç
            score++;
            scoreDisplay.textContent = score;
            
            // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
            gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
            
            // –†–µ–≥—É–ª–∏—Ä—É–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å —Ä–æ—Å—Ç–æ–º —Å—á–µ—Ç–∞ –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ
            const baseSpeed = 10; // –£–≤–µ–ª–∏—á–∏–ª —Å 7 –¥–æ 10
            const speedMultiplier = 1 + (Math.floor(score / 400) * 0.15); // +15% –∫–∞–∂–¥—ã–µ 400 –æ—á–∫–æ–≤
            gameSpeed = baseSpeed * speedMultiplier;
            
            // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å —Ä–æ—Å—Ç–æ–º —Å—á–µ—Ç–∞
            const minObstacleInterval = 700; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–±—ã–ª–æ 800)
            const maxObstacleInterval = 1800; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–±—ã–ª–æ 2000)
            const intervalReduction = Math.floor(score / 150) * 80; // –£—Å–∫–æ—Ä–∏–ª —Å–Ω–∏–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            obstacleInterval = Math.max(maxObstacleInterval - intervalReduction, minObstacleInterval);
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            if (timestamp >= nextObstacleTime) {
                createObstacle();
                
                // –ù–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ —Å –º–µ–Ω—å—à–∏–º —Ä–∞–∑–±—Ä–æ—Å–æ–º –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏
                nextObstacleTime = timestamp + obstacleInterval + (Math.random() * 400 - 200); // –£–º–µ–Ω—å—à–∏–ª —Ä–∞–∑–±—Ä–æ—Å —Å 500
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –º–æ–Ω–µ—Ç–∫–∏
            if (timestamp >= nextCoinTime) {
                createCoin();
                
                // –ù–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
                nextCoinTime = timestamp + coinInterval + (Math.random() * 1000 - 500);
            }
            
            // –°–æ–∑–¥–∞–µ–º –±–æ–Ω—É—Å—ã
            if (timestamp >= nextBonusTime) {
                createBonus();
                
                // –ë–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –±–æ–Ω—É—Å–∞–º–∏
                nextBonusTime = timestamp + bonusInterval + Math.random() * 5000;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            for (let i = 0; i < obstacles.length; i++) {
                const obstacle = obstacles[i];
                
                // –°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                obstacle.x -= gameSpeed * obstacle.speed;
                obstacle.element.style.left = obstacle.x + 'px';
                
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É—à–ª–∏ –∑–∞ —ç–∫—Ä–∞–Ω
                if (obstacle.x < -obstacle.width) {
                    obstacle.element.remove();
                    obstacles.splice(i, 1);
                    i--;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç–æ–∫
            for (let i = 0; i < coins.length; i++) {
                const coin = coins[i];
                
                // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω –º–∞–≥–Ω–∏—Ç, –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ–º –º–æ–Ω–µ—Ç—ã
                if (hasMagnet && !coin.collected) {
                    const playerCenterX = 50 + (activeCharacter.width / 2);
                    const playerCenterY = isJumping ? getJumpHeight() + (activeCharacter.height / 2) : activeCharacter.height / 2;
                    
                    const coinCenterX = coin.x + (coin.width / 2);
                    const coinCenterY = coin.y + (coin.height / 2);
                    
                    // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –∏–≥—Ä–æ–∫–∞ –¥–æ –º–æ–Ω–µ—Ç—ã
                    const dx = playerCenterX - coinCenterX;
                    const dy = playerCenterY - coinCenterY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // –ï—Å–ª–∏ –º–æ–Ω–µ—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ, –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ–º –µ–µ
                    if (distance < 150) {
                        const magnetStrength = 0.1;
                        coin.x += dx * magnetStrength;
                        coin.y += dy * magnetStrength;
                    } else {
                        coin.x -= gameSpeed;
                    }
                } else {
                    coin.x -= gameSpeed;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                coin.element.style.left = coin.x + 'px';
                coin.element.style.bottom = coin.y + 'px';
                
                // –£–¥–∞–ª—è–µ–º –º–æ–Ω–µ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É—à–ª–∏ –∑–∞ —ç–∫—Ä–∞–Ω
                if (coin.x < -coin.width) {
                    coin.element.remove();
                    coins.splice(i, 1);
                    i--;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
            for (let i = 0; i < bonuses.length; i++) {
                const bonus = bonuses[i];
                bonus.x -= gameSpeed;
                bonus.element.style.left = bonus.x + 'px';
                
                // –£–¥–∞–ª—è–µ–º –±–æ–Ω—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —É—à–ª–∏ –∑–∞ —ç–∫—Ä–∞–Ω
                if (bonus.x < -bonus.width) {
                    bonus.element.remove();
                    bonuses.splice(i, 1);
                    i--;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω —Å —É—á–µ—Ç–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏
            updateBackground();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
            checkCollisions();
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop = requestAnimationFrame(update);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –¥–≤–∏–∂–µ–Ω–∏—è
        function updateBackground() {
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç—å—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ñ–æ–Ω–∞
            backgroundPos -= gameSpeed * 0.5; // –§–æ–Ω –¥–≤–∏–∂–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é, –∫–æ–≥–¥–∞ –æ–Ω–∞ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            if (backgroundPos <= -1000) { // –®–∏—Ä–∏–Ω–∞ —Ñ–æ–Ω–∞
                backgroundPos = 0;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ñ–æ–Ω–∞
            gameContainer.style.backgroundPosition = `${backgroundPos}px bottom`;
        }
        
        // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
        async function gameOver() {
            isGameOver = true;
            isGameStarted = false;
            cancelAnimationFrame(gameLoop);
            
            // –ü—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä—ã–∂–∫–∞
            mobileJumpButton.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (gameAPI.currentUser) {
                await gameAPI.updateUserStats(score, coinCount);
                updateAuthUI();
            }
            
            finalScoreDisplay.textContent = score;
            finalCoinsDisplay.textContent = coinCount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞"
            gameOverScreen.style.display = 'block';
            modalOverlay.style.display = 'block';
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ –ø—Ä–æ–∏–≥—Ä—ã—à–∞
            if (soundEnabled) {
                backgroundMusic.pause();
                musicPlaying = false;
                
                if (gameOverSound.src) {
                    gameOverSound.play().catch(e => console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', e));
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            await updateLeaderboard();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        async function saveScore() {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            if (gameAPI.currentUser) {
                await gameAPI.updateUserStats(score, coinCount);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤
            await updateLeaderboard();
        }
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function restartGame() {
            gameOverScreen.style.display = 'none';
            modalOverlay.style.display = 'none';
            startGame();
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏–º–∏—Ç–∞—Ü–∏—é API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        const mockAPI = {
            users: [],
            leaderboard: [],
            
            async login(username, password) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = this.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
                    const token = 'token_' + Math.random().toString(36).substring(2);
                    return {
                        success: true,
                        message: '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ',
                        token,
                        user: { ...user, password: undefined } // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç—É
                    };
                }
                
                return { success: false, message: '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å' };
            },
            
            async register(username, password) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (this.users.some(u => u.username === username)) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
                }
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const newUser = {
                    id: Date.now(),
                    username,
                    password,
                    coins: 0,
                    highScore: 0,
                    gamesPlayed: 0,
                    totalTimeMinutes: 0,
                    lastLogin: new Date().toISOString(),
                    characters: ['default'],
                    activeCharacter: 'default'
                };
                
                this.users.push(newUser);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const token = 'token_' + Math.random().toString(36).substring(2);
                
                return {
                    success: true,
                    message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞',
                    token,
                    user: { ...newUser, password: undefined } // –ù–µ –ø–µ—Ä–µ–¥–∞–µ–º –ø–∞—Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç—É
                };
            },
            
            async verifyToken() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
                return { success: true, user: this.users[0] };
            },
            
            async updateStats(userId, score, coinsCollected) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                const user = this.users[userIndex];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (score > user.highScore) {
                    user.highScore = score;
                }
                
                user.coins += coinsCollected;
                user.gamesPlayed += 1;
                user.lastLogin = new Date().toISOString();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                this.updateLeaderboard();
                
                return {
                    success: true,
                    user: { ...user, password: undefined }
                };
            },
            
            async buyCharacter(userId, characterId) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ ID
                const character = CHARACTERS.find(char => char.id === characterId);
                if (!character) {
                    return { success: false, message: '–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                const user = this.users[userIndex];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂
                if (user.characters.includes(characterId)) {
                    return { success: false, message: '–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂' };
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –º–æ–Ω–µ—Ç
                if (user.coins < character.price) {
                    return { success: false, message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç' };
                }
                
                // –ü–æ–∫—É–ø–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                user.coins -= character.price;
                user.characters.push(characterId);
                
                return {
                    success: true,
                    message: '–ü–µ—Ä—Å–æ–Ω–∞–∂ —É—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω',
                    user: { ...user, password: undefined }
                };
            },
            
            async setActiveCharacter(userId, characterId) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                const user = this.users[userIndex];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —ç—Ç–æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂
                if (!user.characters.includes(characterId)) {
                    return { success: false, message: '–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞' };
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                user.activeCharacter = characterId;
                
                return {
                    success: true,
                    message: '–ü–µ—Ä—Å–æ–Ω–∞–∂ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω',
                    user: { ...user, password: undefined }
                };
            },
            
            async updateTime(userId, minutesSpent) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) {
                    return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                this.users[userIndex].totalTimeMinutes += minutesSpent;
                
                return { success: true };
            },
            
            async getLeaderboard() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                this.updateLeaderboard();
                
                return {
                    success: true,
                    leaderboard: this.leaderboard
                };
            },
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
            updateLeaderboard() {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–µ–∫–æ—Ä–¥—É (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
                this.leaderboard = this.users
                    .map(user => ({
                        rank: 0, // –ó–∞–ø–æ–ª–Ω–∏–º –ø–æ–∑–∂–µ
                        username: user.username,
                        highScore: user.highScore,
                        gamesPlayed: user.gamesPlayed,
                        date: new Date(user.lastLogin).toLocaleDateString()
                    }))
                    .sort((a, b) => b.highScore - a.highScore)
                    .map((user, index) => ({
                        ...user,
                        rank: index + 1
                    }));
            }
        };
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–∫ API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π API
        async function setupAPI() {
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—ã–∑–æ–≤—ã –∫ API –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö –Ω–∞ –º–æ–∫
            const origFetch = window.fetch;
            window.fetch = async function(url, options) {
                if (url.startsWith(API_URL)) {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º endpoint –∏–∑ URL
                    const endpoint = url.replace(API_URL + '/', '');
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
                    let body = {};
                    if (options && options.body) {
                        body = JSON.parse(options.body);
                    }
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    let token = null;
                    let userId = null;
                    if (options && options.headers && options.headers.Authorization) {
                        token = options.headers.Authorization.replace('Bearer ', '');
                        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
                        // –î–ª—è –º–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        userId = mockAPI.users.length > 0 ? mockAPI.users[0].id : null;
                    }
                    
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞–∑–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
                    let response;
                    
                    switch (endpoint) {
                        case 'login':
                            response = await mockAPI.login(body.username, body.password);
                            break;
                        case 'register':
                            response = await mockAPI.register(body.username, body.password);
                            break;
                        case 'verify-token':
                            response = await mockAPI.verifyToken(token);
                            break;
                        case 'update-stats':
                            response = await mockAPI.updateStats(userId, body.score, body.coinsCollected);
                            break;
                        case 'buy-character':
                            response = await mockAPI.buyCharacter(userId, body.characterId);
                            break;
                        case 'set-active-character':
                            response = await mockAPI.setActiveCharacter(userId, body.characterId);
                            break;
                        case 'update-time':
                            response = await mockAPI.updateTime(userId, body.minutesSpent);
                            break;
                        case 'leaderboard':
                            response = await mockAPI.getLeaderboard();
                            break;
                        default:
                            return origFetch(url, options);
                    }
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –æ–∂–∏–¥–∞–µ–º–æ–º fetch
                    return {
                        ok: response.success,
                        json: async () => response
                    };
                }
                
                // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π fetch
                return origFetch(url, options);
            };
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç
            if (mockAPI.users.length === 0) {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                await mockAPI.register('player1', 'password1');
                await mockAPI.register('player2', 'password2');
                await mockAPI.register('player3', 'password3');
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                mockAPI.users[0].highScore = 1500;
                mockAPI.users[0].coins = 200;
                mockAPI.users[0].gamesPlayed = 10;
                mockAPI.users[0].characters = ['default', 'character1'];
                
                mockAPI.users[1].highScore = 2000;
                mockAPI.users[1].coins = 150;
                mockAPI.users[1].gamesPlayed = 8;
                
                mockAPI.users[2].highScore = 1200;
                mockAPI.users[2].coins = 100;
                mockAPI.users[2].gamesPlayed = 5;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
                mockAPI.updateLeaderboard();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async function() {
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            await setupAPI();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            init();
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        gameContainer.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
            